{"do":[{"object":{"name":"biota.core@0.0.1+IndexUpsert","expression":{"if":{"exists":{"function":"biota.core@0.0.1+IndexUpsert"}},"then":{"replace":{"function":"biota.core@0.0.1+IndexUpsert"},"params":{"object":{"name":"biota.core@0.0.1+IndexUpsert","body":{"query":{"lambda":["ctx","params"],"expr":{"let":[{"biota.core@0.0.1+IndexUpsert":{"let":[{"data":{"object":{}}},{"ref":{"object":{}}},{"name":{"select":"name","from":{"var":"params"},"default":null}},{"options":{"select":"options","from":{"var":"params"},"default":{"object":{}}}},{"_inputs":{"object":{"name":{"select":"name","from":{"var":"params"},"default":null},"options":{"select":"options","from":{"var":"params"},"default":{"object":{}}}}}},{"annotate":{"object":{}}}],"in":{"let":[{"ctx":{"object":{}}},{"ctx":{"object":{"identity":{"select":"identity","from":{"var":"ctx"},"default":null},"session":{"select":"session","from":{"var":"ctx"},"default":null},"callstack":{"if":{"is_string":"biota.core@0.0.1+IndexUpsert"},"then":{"prepend":{"select":"callstack","from":{"var":"ctx"},"default":[]},"collection":["biota.core@0.0.1+IndexUpsert"]},"else":{"select":"callstack","from":{"var":"ctx"},"default":[]}},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"success":{"select":"success","from":{"var":"ctx"},"default":true}}}}],"in":{"let":[{"options":{"merge":{"object":{"name":{"var":"name"}}},"with":{"var":"options"}}},{"name":{"select":"name","from":{"var":"options"},"default":null}},{"data":{"select":"data","from":{"var":"options"},"default":{"object":{}}}},{"schema":{"select":"response","from":{"call":"biota.schema@0.0.1+ValidateThrow","arguments":[{"var":"ctx"},{"object":{"code":"data_validation_failed","value":{"var":"options"},"options":{"object":{"type":"schema","schema":"biota.schema@0.0.1+Index.schema","options":{"object":{"optionals":"*"}}}},"state":{"object":{}}}}]},"default":{"object":{}}}}],"in":{"let":[{"response":{"if":{"select":"valid","from":{"select":"response","from":{"call":"biota.schema@0.0.1+Validate","arguments":[{"var":"ctx"},{"object":{"value":{"index":{"var":"name"}},"options":{"object":{"type":"index"}},"state":{"object":{}}}}]},"default":{"object":{}}},"default":false},"then":{"select":"response","from":{"call":"biota.core@0.0.1+IndexUpdate","arguments":[{"var":"ctx"},{"object":{"name":{"var":"name"},"options":{"var":"options"}}}]},"default":{"object":{}}},"else":{"select":"response","from":{"call":"biota.core@0.0.1+IndexInsert","arguments":[{"var":"ctx"},{"object":{"name":{"var":"name"},"options":{"var":"options"}}}]},"default":{"object":{}}}}}],"in":{"object":{"response":{"var":"response"},"success":{"select":"success","from":{"var":"ctx"},"default":true},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"ts":{"now":null}}}}}}}}],"in":{"var":"biota.core@0.0.1+IndexUpsert"}}}}}}},"else":{"create_function":{"object":{"name":"biota.core@0.0.1+IndexUpsert","body":{"query":{"lambda":["ctx","params"],"expr":{"let":[{"biota.core@0.0.1+IndexUpsert":{"let":[{"data":{"object":{}}},{"ref":{"object":{}}},{"name":{"select":"name","from":{"var":"params"},"default":null}},{"options":{"select":"options","from":{"var":"params"},"default":{"object":{}}}},{"_inputs":{"object":{"name":{"select":"name","from":{"var":"params"},"default":null},"options":{"select":"options","from":{"var":"params"},"default":{"object":{}}}}}},{"annotate":{"object":{}}}],"in":{"let":[{"ctx":{"object":{}}},{"ctx":{"object":{"identity":{"select":"identity","from":{"var":"ctx"},"default":null},"session":{"select":"session","from":{"var":"ctx"},"default":null},"callstack":{"if":{"is_string":"biota.core@0.0.1+IndexUpsert"},"then":{"prepend":{"select":"callstack","from":{"var":"ctx"},"default":[]},"collection":["biota.core@0.0.1+IndexUpsert"]},"else":{"select":"callstack","from":{"var":"ctx"},"default":[]}},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"success":{"select":"success","from":{"var":"ctx"},"default":true}}}}],"in":{"let":[{"options":{"merge":{"object":{"name":{"var":"name"}}},"with":{"var":"options"}}},{"name":{"select":"name","from":{"var":"options"},"default":null}},{"data":{"select":"data","from":{"var":"options"},"default":{"object":{}}}},{"schema":{"select":"response","from":{"call":"biota.schema@0.0.1+ValidateThrow","arguments":[{"var":"ctx"},{"object":{"code":"data_validation_failed","value":{"var":"options"},"options":{"object":{"type":"schema","schema":"biota.schema@0.0.1+Index.schema","options":{"object":{"optionals":"*"}}}},"state":{"object":{}}}}]},"default":{"object":{}}}}],"in":{"let":[{"response":{"if":{"select":"valid","from":{"select":"response","from":{"call":"biota.schema@0.0.1+Validate","arguments":[{"var":"ctx"},{"object":{"value":{"index":{"var":"name"}},"options":{"object":{"type":"index"}},"state":{"object":{}}}}]},"default":{"object":{}}},"default":false},"then":{"select":"response","from":{"call":"biota.core@0.0.1+IndexUpdate","arguments":[{"var":"ctx"},{"object":{"name":{"var":"name"},"options":{"var":"options"}}}]},"default":{"object":{}}},"else":{"select":"response","from":{"call":"biota.core@0.0.1+IndexInsert","arguments":[{"var":"ctx"},{"object":{"name":{"var":"name"},"options":{"var":"options"}}}]},"default":{"object":{}}}}}],"in":{"object":{"response":{"var":"response"},"success":{"select":"success","from":{"var":"ctx"},"default":true},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"ts":{"now":null}}}}}}}}],"in":{"var":"biota.core@0.0.1+IndexUpsert"}}}}}}}}}},{"object":{"name":"biota.core@0.0.1+IndexReplace","expression":{"if":{"exists":{"function":"biota.core@0.0.1+IndexReplace"}},"then":{"replace":{"function":"biota.core@0.0.1+IndexReplace"},"params":{"object":{"name":"biota.core@0.0.1+IndexReplace","body":{"query":{"lambda":["ctx","params"],"expr":{"let":[{"biota.core@0.0.1+IndexReplace":{"let":[{"data":{"object":{}}},{"ref":{"object":{}}},{"name":{"select":"name","from":{"var":"params"},"default":null}},{"options":{"select":"options","from":{"var":"params"},"default":{"object":{}}}},{"_inputs":{"object":{"name":{"select":"name","from":{"var":"params"},"default":null},"options":{"select":"options","from":{"var":"params"},"default":{"object":{}}}}}},{"annotate":{"object":{}}}],"in":{"let":[{"ctx":{"object":{}}},{"ctx":{"object":{"identity":{"select":"identity","from":{"var":"ctx"},"default":null},"session":{"select":"session","from":{"var":"ctx"},"default":null},"callstack":{"if":{"is_string":"biota.core@0.0.1+IndexReplace"},"then":{"prepend":{"select":"callstack","from":{"var":"ctx"},"default":[]},"collection":["biota.core@0.0.1+IndexReplace"]},"else":{"select":"callstack","from":{"var":"ctx"},"default":[]}},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"success":{"select":"success","from":{"var":"ctx"},"default":true}}}}],"in":{"let":[{"options":{"merge":{"object":{"name":{"var":"name"}}},"with":{"var":"options"}}},{"name":{"select":"name","from":{"var":"options"},"default":null}},{"ref":{"index":{"var":"name"}}},{"valid":{"select":"response","from":{"call":"biota.schema@0.0.1+ValidateThrow","arguments":[{"var":"ctx"},{"object":{"code":"instance_not_found","value":{"var":"ref"},"options":{"object":{"type":"index"}},"state":{"object":{}}}}]},"default":{"object":{}}}},{"doc":{"select":"response","from":{"call":"biota.core@0.0.1+IndexGet","arguments":[{"var":"ctx"},{"object":{"name":{"var":"name"}}}]},"default":{"object":{}}}},{"data":{"select":"data","from":{"var":"doc"},"default":{"object":{}}}}],"in":{"let":[{"annotationName":"replace"},{"annotationData":{"var":"data"}},{"annotationInputs":{"var":"annotate"}},{"data":{"select":"response","from":{"call":"biota.builder@0.0.1+Annotate","arguments":[{"var":"ctx"},{"object":{"action":{"var":"annotationName"},"data":{"var":"annotationData"},"input":{"var":"annotationInputs"}}}]},"default":{"object":{}}}}],"in":{"let":[{"response":{"replace":{"index":{"var":"name"}},"params":{"merge":{"merge":{"object":{"name":{"var":"name"}}},"with":{"var":"options"}},"with":{"object":{"data":{"var":"data"}}}}}}],"in":{"let":[{"actionName":"replace"},{"actionRef":{"select":"ref","from":{"var":"response"},"default":null}},{"data":{"if":{"not":{"is_null":{"var":"actionRef"}}},"then":{"select":"response","from":{"call":"biota.builder@0.0.1+ActionLog","arguments":[{"var":"ctx"},{"object":{"name":{"var":"actionName"},"instance":{"var":"actionRef"}}}]},"default":{"object":{}}},"else":""}}],"in":{"object":{"response":{"var":"response"},"success":{"select":"success","from":{"var":"ctx"},"default":true},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"ts":{"now":null}}}}}}}}}}],"in":{"var":"biota.core@0.0.1+IndexReplace"}}}}}}},"else":{"create_function":{"object":{"name":"biota.core@0.0.1+IndexReplace","body":{"query":{"lambda":["ctx","params"],"expr":{"let":[{"biota.core@0.0.1+IndexReplace":{"let":[{"data":{"object":{}}},{"ref":{"object":{}}},{"name":{"select":"name","from":{"var":"params"},"default":null}},{"options":{"select":"options","from":{"var":"params"},"default":{"object":{}}}},{"_inputs":{"object":{"name":{"select":"name","from":{"var":"params"},"default":null},"options":{"select":"options","from":{"var":"params"},"default":{"object":{}}}}}},{"annotate":{"object":{}}}],"in":{"let":[{"ctx":{"object":{}}},{"ctx":{"object":{"identity":{"select":"identity","from":{"var":"ctx"},"default":null},"session":{"select":"session","from":{"var":"ctx"},"default":null},"callstack":{"if":{"is_string":"biota.core@0.0.1+IndexReplace"},"then":{"prepend":{"select":"callstack","from":{"var":"ctx"},"default":[]},"collection":["biota.core@0.0.1+IndexReplace"]},"else":{"select":"callstack","from":{"var":"ctx"},"default":[]}},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"success":{"select":"success","from":{"var":"ctx"},"default":true}}}}],"in":{"let":[{"options":{"merge":{"object":{"name":{"var":"name"}}},"with":{"var":"options"}}},{"name":{"select":"name","from":{"var":"options"},"default":null}},{"ref":{"index":{"var":"name"}}},{"valid":{"select":"response","from":{"call":"biota.schema@0.0.1+ValidateThrow","arguments":[{"var":"ctx"},{"object":{"code":"instance_not_found","value":{"var":"ref"},"options":{"object":{"type":"index"}},"state":{"object":{}}}}]},"default":{"object":{}}}},{"doc":{"select":"response","from":{"call":"biota.core@0.0.1+IndexGet","arguments":[{"var":"ctx"},{"object":{"name":{"var":"name"}}}]},"default":{"object":{}}}},{"data":{"select":"data","from":{"var":"doc"},"default":{"object":{}}}}],"in":{"let":[{"annotationName":"replace"},{"annotationData":{"var":"data"}},{"annotationInputs":{"var":"annotate"}},{"data":{"select":"response","from":{"call":"biota.builder@0.0.1+Annotate","arguments":[{"var":"ctx"},{"object":{"action":{"var":"annotationName"},"data":{"var":"annotationData"},"input":{"var":"annotationInputs"}}}]},"default":{"object":{}}}}],"in":{"let":[{"response":{"replace":{"index":{"var":"name"}},"params":{"merge":{"merge":{"object":{"name":{"var":"name"}}},"with":{"var":"options"}},"with":{"object":{"data":{"var":"data"}}}}}}],"in":{"let":[{"actionName":"replace"},{"actionRef":{"select":"ref","from":{"var":"response"},"default":null}},{"data":{"if":{"not":{"is_null":{"var":"actionRef"}}},"then":{"select":"response","from":{"call":"biota.builder@0.0.1+ActionLog","arguments":[{"var":"ctx"},{"object":{"name":{"var":"actionName"},"instance":{"var":"actionRef"}}}]},"default":{"object":{}}},"else":""}}],"in":{"object":{"response":{"var":"response"},"success":{"select":"success","from":{"var":"ctx"},"default":true},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"ts":{"now":null}}}}}}}}}}],"in":{"var":"biota.core@0.0.1+IndexReplace"}}}}}}}}}},{"object":{"name":"biota.core@0.0.1+IndexRepsert","expression":{"if":{"exists":{"function":"biota.core@0.0.1+IndexRepsert"}},"then":{"replace":{"function":"biota.core@0.0.1+IndexRepsert"},"params":{"object":{"name":"biota.core@0.0.1+IndexRepsert","body":{"query":{"lambda":["ctx","params"],"expr":{"let":[{"biota.core@0.0.1+IndexRepsert":{"let":[{"data":{"object":{}}},{"ref":{"object":{}}},{"name":{"select":"name","from":{"var":"params"},"default":null}},{"options":{"select":"options","from":{"var":"params"},"default":{"object":{}}}},{"_inputs":{"object":{"name":{"select":"name","from":{"var":"params"},"default":null},"options":{"select":"options","from":{"var":"params"},"default":{"object":{}}}}}},{"annotate":{"object":{}}}],"in":{"let":[{"ctx":{"object":{}}},{"ctx":{"object":{"identity":{"select":"identity","from":{"var":"ctx"},"default":null},"session":{"select":"session","from":{"var":"ctx"},"default":null},"callstack":{"if":{"is_string":"biota.core@0.0.1+IndexRepsert"},"then":{"prepend":{"select":"callstack","from":{"var":"ctx"},"default":[]},"collection":["biota.core@0.0.1+IndexRepsert"]},"else":{"select":"callstack","from":{"var":"ctx"},"default":[]}},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"success":{"select":"success","from":{"var":"ctx"},"default":true}}}}],"in":{"let":[{"options":{"merge":{"object":{"name":{"var":"name"}}},"with":{"var":"options"}}},{"name":{"select":"name","from":{"var":"options"},"default":null}},{"data":{"select":"data","from":{"var":"options"},"default":{"object":{}}}},{"schema":{"select":"response","from":{"call":"biota.schema@0.0.1+ValidateThrow","arguments":[{"var":"ctx"},{"object":{"code":"data_validation_failed","value":{"var":"options"},"options":{"object":{"type":"schema","schema":"biota.schema@0.0.1+Index.schema","options":{"object":{"optionals":"*"}}}},"state":{"object":{}}}}]},"default":{"object":{}}}}],"in":{"let":[{"response":{"if":{"select":"valid","from":{"select":"response","from":{"call":"biota.schema@0.0.1+Validate","arguments":[{"var":"ctx"},{"object":{"value":{"index":{"var":"name"}},"options":{"object":{"type":"index"}},"state":{"object":{}}}}]},"default":{"object":{}}},"default":false},"then":{"select":"response","from":{"call":"biota.core@0.0.1+IndexReplace","arguments":[{"var":"ctx"},{"object":{"name":{"var":"name"},"options":{"var":"options"}}}]},"default":{"object":{}}},"else":{"select":"response","from":{"call":"biota.core@0.0.1+IndexInsert","arguments":[{"var":"ctx"},{"object":{"name":{"var":"name"},"options":{"var":"options"}}}]},"default":{"object":{}}}}}],"in":{"object":{"response":{"var":"response"},"success":{"select":"success","from":{"var":"ctx"},"default":true},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"ts":{"now":null}}}}}}}}],"in":{"var":"biota.core@0.0.1+IndexRepsert"}}}}}}},"else":{"create_function":{"object":{"name":"biota.core@0.0.1+IndexRepsert","body":{"query":{"lambda":["ctx","params"],"expr":{"let":[{"biota.core@0.0.1+IndexRepsert":{"let":[{"data":{"object":{}}},{"ref":{"object":{}}},{"name":{"select":"name","from":{"var":"params"},"default":null}},{"options":{"select":"options","from":{"var":"params"},"default":{"object":{}}}},{"_inputs":{"object":{"name":{"select":"name","from":{"var":"params"},"default":null},"options":{"select":"options","from":{"var":"params"},"default":{"object":{}}}}}},{"annotate":{"object":{}}}],"in":{"let":[{"ctx":{"object":{}}},{"ctx":{"object":{"identity":{"select":"identity","from":{"var":"ctx"},"default":null},"session":{"select":"session","from":{"var":"ctx"},"default":null},"callstack":{"if":{"is_string":"biota.core@0.0.1+IndexRepsert"},"then":{"prepend":{"select":"callstack","from":{"var":"ctx"},"default":[]},"collection":["biota.core@0.0.1+IndexRepsert"]},"else":{"select":"callstack","from":{"var":"ctx"},"default":[]}},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"success":{"select":"success","from":{"var":"ctx"},"default":true}}}}],"in":{"let":[{"options":{"merge":{"object":{"name":{"var":"name"}}},"with":{"var":"options"}}},{"name":{"select":"name","from":{"var":"options"},"default":null}},{"data":{"select":"data","from":{"var":"options"},"default":{"object":{}}}},{"schema":{"select":"response","from":{"call":"biota.schema@0.0.1+ValidateThrow","arguments":[{"var":"ctx"},{"object":{"code":"data_validation_failed","value":{"var":"options"},"options":{"object":{"type":"schema","schema":"biota.schema@0.0.1+Index.schema","options":{"object":{"optionals":"*"}}}},"state":{"object":{}}}}]},"default":{"object":{}}}}],"in":{"let":[{"response":{"if":{"select":"valid","from":{"select":"response","from":{"call":"biota.schema@0.0.1+Validate","arguments":[{"var":"ctx"},{"object":{"value":{"index":{"var":"name"}},"options":{"object":{"type":"index"}},"state":{"object":{}}}}]},"default":{"object":{}}},"default":false},"then":{"select":"response","from":{"call":"biota.core@0.0.1+IndexReplace","arguments":[{"var":"ctx"},{"object":{"name":{"var":"name"},"options":{"var":"options"}}}]},"default":{"object":{}}},"else":{"select":"response","from":{"call":"biota.core@0.0.1+IndexInsert","arguments":[{"var":"ctx"},{"object":{"name":{"var":"name"},"options":{"var":"options"}}}]},"default":{"object":{}}}}}],"in":{"object":{"response":{"var":"response"},"success":{"select":"success","from":{"var":"ctx"},"default":true},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"ts":{"now":null}}}}}}}}],"in":{"var":"biota.core@0.0.1+IndexRepsert"}}}}}}}}}},{"object":{"name":"biota.core@0.0.1+IndexDelete","expression":{"if":{"exists":{"function":"biota.core@0.0.1+IndexDelete"}},"then":{"replace":{"function":"biota.core@0.0.1+IndexDelete"},"params":{"object":{"name":"biota.core@0.0.1+IndexDelete","body":{"query":{"lambda":["ctx","params"],"expr":{"let":[{"biota.core@0.0.1+IndexDelete":{"let":[{"data":{"object":{}}},{"ref":{"object":{}}},{"name":{"select":"name","from":{"var":"params"},"default":null}},{"_inputs":{"object":{"name":{"select":"name","from":{"var":"params"},"default":null}}}},{"annotate":{"object":{}}}],"in":{"let":[{"ctx":{"object":{}}},{"ctx":{"object":{"identity":{"select":"identity","from":{"var":"ctx"},"default":null},"session":{"select":"session","from":{"var":"ctx"},"default":null},"callstack":{"if":{"is_string":"biota.core@0.0.1+IndexDelete"},"then":{"prepend":{"select":"callstack","from":{"var":"ctx"},"default":[]},"collection":["biota.core@0.0.1+IndexDelete"]},"else":{"select":"callstack","from":{"var":"ctx"},"default":[]}},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"success":{"select":"success","from":{"var":"ctx"},"default":true}}}}],"in":{"let":[{"ref":{"index":{"var":"name"}}},{"valid":{"select":"response","from":{"call":"biota.schema@0.0.1+ValidateThrow","arguments":[{"var":"ctx"},{"object":{"code":"instance_not_found","value":{"var":"ref"},"options":{"object":{"type":"index"}},"state":{"object":{}}}}]},"default":{"object":{}}}}],"in":{"let":[{"annotationName":"delete"},{"annotationData":{"var":"data"}},{"annotationInputs":{"var":"annotate"}},{"data":{"select":"response","from":{"call":"biota.builder@0.0.1+Annotate","arguments":[{"var":"ctx"},{"object":{"action":{"var":"annotationName"},"data":{"var":"annotationData"},"input":{"var":"annotationInputs"}}}]},"default":{"object":{}}}}],"in":{"let":[{"response":{"select":"response","from":{"call":"biota.core@0.0.1+IndexUpsert","arguments":[{"var":"ctx"},{"object":{"name":{"var":"name"},"options":{"object":{"data":{"var":"data"}}}}}]},"default":{"object":{}}}}],"in":{"let":[{"actionName":"delete"},{"actionRef":{"select":"ref","from":{"var":"response"},"default":null}},{"data":{"if":{"not":{"is_null":{"var":"actionRef"}}},"then":{"select":"response","from":{"call":"biota.builder@0.0.1+ActionLog","arguments":[{"var":"ctx"},{"object":{"name":{"var":"actionName"},"instance":{"var":"actionRef"}}}]},"default":{"object":{}}},"else":""}}],"in":{"object":{"response":{"var":"response"},"success":{"select":"success","from":{"var":"ctx"},"default":true},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"ts":{"now":null}}}}}}}}}}],"in":{"var":"biota.core@0.0.1+IndexDelete"}}}}}}},"else":{"create_function":{"object":{"name":"biota.core@0.0.1+IndexDelete","body":{"query":{"lambda":["ctx","params"],"expr":{"let":[{"biota.core@0.0.1+IndexDelete":{"let":[{"data":{"object":{}}},{"ref":{"object":{}}},{"name":{"select":"name","from":{"var":"params"},"default":null}},{"_inputs":{"object":{"name":{"select":"name","from":{"var":"params"},"default":null}}}},{"annotate":{"object":{}}}],"in":{"let":[{"ctx":{"object":{}}},{"ctx":{"object":{"identity":{"select":"identity","from":{"var":"ctx"},"default":null},"session":{"select":"session","from":{"var":"ctx"},"default":null},"callstack":{"if":{"is_string":"biota.core@0.0.1+IndexDelete"},"then":{"prepend":{"select":"callstack","from":{"var":"ctx"},"default":[]},"collection":["biota.core@0.0.1+IndexDelete"]},"else":{"select":"callstack","from":{"var":"ctx"},"default":[]}},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"success":{"select":"success","from":{"var":"ctx"},"default":true}}}}],"in":{"let":[{"ref":{"index":{"var":"name"}}},{"valid":{"select":"response","from":{"call":"biota.schema@0.0.1+ValidateThrow","arguments":[{"var":"ctx"},{"object":{"code":"instance_not_found","value":{"var":"ref"},"options":{"object":{"type":"index"}},"state":{"object":{}}}}]},"default":{"object":{}}}}],"in":{"let":[{"annotationName":"delete"},{"annotationData":{"var":"data"}},{"annotationInputs":{"var":"annotate"}},{"data":{"select":"response","from":{"call":"biota.builder@0.0.1+Annotate","arguments":[{"var":"ctx"},{"object":{"action":{"var":"annotationName"},"data":{"var":"annotationData"},"input":{"var":"annotationInputs"}}}]},"default":{"object":{}}}}],"in":{"let":[{"response":{"select":"response","from":{"call":"biota.core@0.0.1+IndexUpsert","arguments":[{"var":"ctx"},{"object":{"name":{"var":"name"},"options":{"object":{"data":{"var":"data"}}}}}]},"default":{"object":{}}}}],"in":{"let":[{"actionName":"delete"},{"actionRef":{"select":"ref","from":{"var":"response"},"default":null}},{"data":{"if":{"not":{"is_null":{"var":"actionRef"}}},"then":{"select":"response","from":{"call":"biota.builder@0.0.1+ActionLog","arguments":[{"var":"ctx"},{"object":{"name":{"var":"actionName"},"instance":{"var":"actionRef"}}}]},"default":{"object":{}}},"else":""}}],"in":{"object":{"response":{"var":"response"},"success":{"select":"success","from":{"var":"ctx"},"default":true},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"ts":{"now":null}}}}}}}}}}],"in":{"var":"biota.core@0.0.1+IndexDelete"}}}}}}}}}},{"object":{"name":"biota.core@0.0.1+IndexRestore","expression":{"if":{"exists":{"function":"biota.core@0.0.1+IndexRestore"}},"then":{"replace":{"function":"biota.core@0.0.1+IndexRestore"},"params":{"object":{"name":"biota.core@0.0.1+IndexRestore","body":{"query":{"lambda":["ctx","params"],"expr":{"let":[{"biota.core@0.0.1+IndexRestore":{"let":[{"data":{"object":{}}},{"ref":{"object":{}}},{"name":{"select":"name","from":{"var":"params"},"default":null}},{"_inputs":{"object":{"name":{"select":"name","from":{"var":"params"},"default":null}}}},{"annotate":{"object":{}}}],"in":{"let":[{"ctx":{"object":{}}},{"ctx":{"object":{"identity":{"select":"identity","from":{"var":"ctx"},"default":null},"session":{"select":"session","from":{"var":"ctx"},"default":null},"callstack":{"if":{"is_string":"biota.core@0.0.1+IndexRestore"},"then":{"prepend":{"select":"callstack","from":{"var":"ctx"},"default":[]},"collection":["biota.core@0.0.1+IndexRestore"]},"else":{"select":"callstack","from":{"var":"ctx"},"default":[]}},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"success":{"select":"success","from":{"var":"ctx"},"default":true}}}}],"in":{"let":[{"ref":{"index":{"var":"name"}}},{"valid":{"select":"response","from":{"call":"biota.schema@0.0.1+ValidateThrow","arguments":[{"var":"ctx"},{"object":{"code":"instance_not_found","value":{"var":"ref"},"options":{"object":{"type":"index"}},"state":{"object":{}}}}]},"default":{"object":{}}}},{"doc":{"select":"response","from":{"call":"biota.core@0.0.1+IndexGet","arguments":[{"var":"ctx"},{"object":{"name":{"var":"name"}}}]},"default":{"object":{}}}},{"data":{"select":"data","from":{"var":"doc"},"default":{"object":{}}}},{"isDeleted":{"select":"response","from":{"call":"biota.core@0.0.1+DataIsDeleted","arguments":[{"var":"ctx"},{"object":{"data":{"var":"data"}}}]},"default":{"object":{}}}},{"isExpired":{"select":"response","from":{"call":"biota.core@0.0.1+DataIsExpired","arguments":[{"var":"ctx"},{"object":{"data":{"var":"data"}}}]},"default":{"object":{}}}}],"in":{"let":[{"annotationName":"restore"},{"annotationData":{"var":"data"}},{"annotationInputs":{"var":"annotate"}},{"data":{"select":"response","from":{"call":"biota.builder@0.0.1+Annotate","arguments":[{"var":"ctx"},{"object":{"action":{"var":"annotationName"},"data":{"var":"annotationData"},"input":{"var":"annotationInputs"}}}]},"default":{"object":{}}}}],"in":{"let":[{"response":{"select":"response","from":{"call":"biota.core@0.0.1+IndexUpsert","arguments":[{"var":"ctx"},{"object":{"name":{"var":"name"},"options":{"object":{"data":{"var":"data"}}}}}]},"default":{"object":{}}}}],"in":{"let":[{"actionName":"restore"},{"actionRef":{"select":"ref","from":{"var":"response"},"default":null}},{"data":{"if":{"not":{"is_null":{"var":"actionRef"}}},"then":{"select":"response","from":{"call":"biota.builder@0.0.1+ActionLog","arguments":[{"var":"ctx"},{"object":{"name":{"var":"actionName"},"instance":{"var":"actionRef"}}}]},"default":{"object":{}}},"else":""}}],"in":{"object":{"response":{"var":"response"},"success":{"select":"success","from":{"var":"ctx"},"default":true},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"ts":{"now":null}}}}}}}}}}],"in":{"var":"biota.core@0.0.1+IndexRestore"}}}}}}},"else":{"create_function":{"object":{"name":"biota.core@0.0.1+IndexRestore","body":{"query":{"lambda":["ctx","params"],"expr":{"let":[{"biota.core@0.0.1+IndexRestore":{"let":[{"data":{"object":{}}},{"ref":{"object":{}}},{"name":{"select":"name","from":{"var":"params"},"default":null}},{"_inputs":{"object":{"name":{"select":"name","from":{"var":"params"},"default":null}}}},{"annotate":{"object":{}}}],"in":{"let":[{"ctx":{"object":{}}},{"ctx":{"object":{"identity":{"select":"identity","from":{"var":"ctx"},"default":null},"session":{"select":"session","from":{"var":"ctx"},"default":null},"callstack":{"if":{"is_string":"biota.core@0.0.1+IndexRestore"},"then":{"prepend":{"select":"callstack","from":{"var":"ctx"},"default":[]},"collection":["biota.core@0.0.1+IndexRestore"]},"else":{"select":"callstack","from":{"var":"ctx"},"default":[]}},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"success":{"select":"success","from":{"var":"ctx"},"default":true}}}}],"in":{"let":[{"ref":{"index":{"var":"name"}}},{"valid":{"select":"response","from":{"call":"biota.schema@0.0.1+ValidateThrow","arguments":[{"var":"ctx"},{"object":{"code":"instance_not_found","value":{"var":"ref"},"options":{"object":{"type":"index"}},"state":{"object":{}}}}]},"default":{"object":{}}}},{"doc":{"select":"response","from":{"call":"biota.core@0.0.1+IndexGet","arguments":[{"var":"ctx"},{"object":{"name":{"var":"name"}}}]},"default":{"object":{}}}},{"data":{"select":"data","from":{"var":"doc"},"default":{"object":{}}}},{"isDeleted":{"select":"response","from":{"call":"biota.core@0.0.1+DataIsDeleted","arguments":[{"var":"ctx"},{"object":{"data":{"var":"data"}}}]},"default":{"object":{}}}},{"isExpired":{"select":"response","from":{"call":"biota.core@0.0.1+DataIsExpired","arguments":[{"var":"ctx"},{"object":{"data":{"var":"data"}}}]},"default":{"object":{}}}}],"in":{"let":[{"annotationName":"restore"},{"annotationData":{"var":"data"}},{"annotationInputs":{"var":"annotate"}},{"data":{"select":"response","from":{"call":"biota.builder@0.0.1+Annotate","arguments":[{"var":"ctx"},{"object":{"action":{"var":"annotationName"},"data":{"var":"annotationData"},"input":{"var":"annotationInputs"}}}]},"default":{"object":{}}}}],"in":{"let":[{"response":{"select":"response","from":{"call":"biota.core@0.0.1+IndexUpsert","arguments":[{"var":"ctx"},{"object":{"name":{"var":"name"},"options":{"object":{"data":{"var":"data"}}}}}]},"default":{"object":{}}}}],"in":{"let":[{"actionName":"restore"},{"actionRef":{"select":"ref","from":{"var":"response"},"default":null}},{"data":{"if":{"not":{"is_null":{"var":"actionRef"}}},"then":{"select":"response","from":{"call":"biota.builder@0.0.1+ActionLog","arguments":[{"var":"ctx"},{"object":{"name":{"var":"actionName"},"instance":{"var":"actionRef"}}}]},"default":{"object":{}}},"else":""}}],"in":{"object":{"response":{"var":"response"},"success":{"select":"success","from":{"var":"ctx"},"default":true},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"ts":{"now":null}}}}}}}}}}],"in":{"var":"biota.core@0.0.1+IndexRestore"}}}}}}}}}},{"object":{"name":"biota.core@0.0.1+IndexForget","expression":{"if":{"exists":{"function":"biota.core@0.0.1+IndexForget"}},"then":{"replace":{"function":"biota.core@0.0.1+IndexForget"},"params":{"object":{"name":"biota.core@0.0.1+IndexForget","body":{"query":{"lambda":["ctx","params"],"expr":{"let":[{"biota.core@0.0.1+IndexForget":{"let":[{"data":{"object":{}}},{"ref":{"object":{}}},{"name":{"select":"name","from":{"var":"params"},"default":null}},{"_inputs":{"object":{"name":{"select":"name","from":{"var":"params"},"default":null}}}},{"annotate":{"object":{}}}],"in":{"let":[{"ctx":{"object":{}}},{"ctx":{"object":{"identity":{"select":"identity","from":{"var":"ctx"},"default":null},"session":{"select":"session","from":{"var":"ctx"},"default":null},"callstack":{"if":{"is_string":"biota.core@0.0.1+IndexForget"},"then":{"prepend":{"select":"callstack","from":{"var":"ctx"},"default":[]},"collection":["biota.core@0.0.1+IndexForget"]},"else":{"select":"callstack","from":{"var":"ctx"},"default":[]}},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"success":{"select":"success","from":{"var":"ctx"},"default":true}}}}],"in":{"let":[{"ref":{"index":{"var":"name"}}},{"valid":{"select":"response","from":{"call":"biota.schema@0.0.1+ValidateThrow","arguments":[{"var":"ctx"},{"object":{"code":"instance_not_found","value":{"var":"ref"},"options":{"object":{"type":"index"}},"state":{"object":{}}}}]},"default":{"object":{}}}}],"in":{"let":[{"annotationName":"forget"},{"annotationData":{"var":"data"}},{"annotationInputs":{"var":"annotate"}},{"data":{"select":"response","from":{"call":"biota.builder@0.0.1+Annotate","arguments":[{"var":"ctx"},{"object":{"action":{"var":"annotationName"},"data":{"var":"annotationData"},"input":{"var":"annotationInputs"}}}]},"default":{"object":{}}}}],"in":{"let":[{"response":{"select":"response","from":{"call":"biota.core@0.0.1+IndexUpsert","arguments":[{"var":"ctx"},{"object":{"name":{"var":"name"},"options":{"object":{"data":{"var":"data"}}}}}]},"default":{"object":{}}}}],"in":{"let":[{"actionName":"forget"},{"actionRef":{"select":"ref","from":{"var":"response"},"default":null}},{"data":{"if":{"not":{"is_null":{"var":"actionRef"}}},"then":{"select":"response","from":{"call":"biota.builder@0.0.1+ActionLog","arguments":[{"var":"ctx"},{"object":{"name":{"var":"actionName"},"instance":{"var":"actionRef"}}}]},"default":{"object":{}}},"else":""}}],"in":{"let":[{"response":{"delete":{"index":{"var":"name"}}}}],"in":{"object":{"response":{"var":"response"},"success":{"select":"success","from":{"var":"ctx"},"default":true},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"ts":{"now":null}}}}}}}}}}}],"in":{"var":"biota.core@0.0.1+IndexForget"}}}}}}},"else":{"create_function":{"object":{"name":"biota.core@0.0.1+IndexForget","body":{"query":{"lambda":["ctx","params"],"expr":{"let":[{"biota.core@0.0.1+IndexForget":{"let":[{"data":{"object":{}}},{"ref":{"object":{}}},{"name":{"select":"name","from":{"var":"params"},"default":null}},{"_inputs":{"object":{"name":{"select":"name","from":{"var":"params"},"default":null}}}},{"annotate":{"object":{}}}],"in":{"let":[{"ctx":{"object":{}}},{"ctx":{"object":{"identity":{"select":"identity","from":{"var":"ctx"},"default":null},"session":{"select":"session","from":{"var":"ctx"},"default":null},"callstack":{"if":{"is_string":"biota.core@0.0.1+IndexForget"},"then":{"prepend":{"select":"callstack","from":{"var":"ctx"},"default":[]},"collection":["biota.core@0.0.1+IndexForget"]},"else":{"select":"callstack","from":{"var":"ctx"},"default":[]}},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"success":{"select":"success","from":{"var":"ctx"},"default":true}}}}],"in":{"let":[{"ref":{"index":{"var":"name"}}},{"valid":{"select":"response","from":{"call":"biota.schema@0.0.1+ValidateThrow","arguments":[{"var":"ctx"},{"object":{"code":"instance_not_found","value":{"var":"ref"},"options":{"object":{"type":"index"}},"state":{"object":{}}}}]},"default":{"object":{}}}}],"in":{"let":[{"annotationName":"forget"},{"annotationData":{"var":"data"}},{"annotationInputs":{"var":"annotate"}},{"data":{"select":"response","from":{"call":"biota.builder@0.0.1+Annotate","arguments":[{"var":"ctx"},{"object":{"action":{"var":"annotationName"},"data":{"var":"annotationData"},"input":{"var":"annotationInputs"}}}]},"default":{"object":{}}}}],"in":{"let":[{"response":{"select":"response","from":{"call":"biota.core@0.0.1+IndexUpsert","arguments":[{"var":"ctx"},{"object":{"name":{"var":"name"},"options":{"object":{"data":{"var":"data"}}}}}]},"default":{"object":{}}}}],"in":{"let":[{"actionName":"forget"},{"actionRef":{"select":"ref","from":{"var":"response"},"default":null}},{"data":{"if":{"not":{"is_null":{"var":"actionRef"}}},"then":{"select":"response","from":{"call":"biota.builder@0.0.1+ActionLog","arguments":[{"var":"ctx"},{"object":{"name":{"var":"actionName"},"instance":{"var":"actionRef"}}}]},"default":{"object":{}}},"else":""}}],"in":{"let":[{"response":{"delete":{"index":{"var":"name"}}}}],"in":{"object":{"response":{"var":"response"},"success":{"select":"success","from":{"var":"ctx"},"default":true},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"ts":{"now":null}}}}}}}}}}}],"in":{"var":"biota.core@0.0.1+IndexForget"}}}}}}}}}},{"object":{"name":"biota.core@0.0.1+IndexDrop","expression":{"if":{"exists":{"function":"biota.core@0.0.1+IndexDrop"}},"then":{"replace":{"function":"biota.core@0.0.1+IndexDrop"},"params":{"object":{"name":"biota.core@0.0.1+IndexDrop","body":{"query":{"lambda":["ctx","params"],"expr":{"let":[{"biota.core@0.0.1+IndexDrop":{"let":[{"data":{"object":{}}},{"ref":{"object":{}}},{"name":{"select":"name","from":{"var":"params"},"default":null}},{"_inputs":{"object":{"name":{"select":"name","from":{"var":"params"},"default":null}}}},{"annotate":{"object":{}}}],"in":{"let":[{"ctx":{"object":{}}},{"ctx":{"object":{"identity":{"select":"identity","from":{"var":"ctx"},"default":null},"session":{"select":"session","from":{"var":"ctx"},"default":null},"callstack":{"if":{"is_string":"biota.core@0.0.1+IndexDrop"},"then":{"prepend":{"select":"callstack","from":{"var":"ctx"},"default":[]},"collection":["biota.core@0.0.1+IndexDrop"]},"else":{"select":"callstack","from":{"var":"ctx"},"default":[]}},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"success":{"select":"success","from":{"var":"ctx"},"default":true}}}}],"in":{"let":[{"ref":{"index":{"var":"name"}}},{"valid":{"select":"response","from":{"call":"biota.schema@0.0.1+ValidateThrow","arguments":[{"var":"ctx"},{"object":{"code":"instance_not_found","value":{"var":"ref"},"options":{"object":{"type":"index"}},"state":{"object":{}}}}]},"default":{"object":{}}}}],"in":{"let":[{"response":{"if":{"select":"valid","from":{"select":"response","from":{"call":"biota.schema@0.0.1+Validate","arguments":[{"var":"ctx"},{"object":{"value":{"var":"ref"},"options":{"object":{"type":"index"}},"state":{"object":{}}}}]},"default":{"object":{}}},"default":false},"then":{"select":"response","from":{"call":"biota.core@0.0.1+IndexForget","arguments":[{"var":"ctx"},{"object":{"name":{"var":"name"}}}]},"default":{"object":{}}},"else":{"object":{}}}}],"in":{"object":{"response":{"var":"response"},"success":{"select":"success","from":{"var":"ctx"},"default":true},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"ts":{"now":null}}}}}}}}],"in":{"var":"biota.core@0.0.1+IndexDrop"}}}}}}},"else":{"create_function":{"object":{"name":"biota.core@0.0.1+IndexDrop","body":{"query":{"lambda":["ctx","params"],"expr":{"let":[{"biota.core@0.0.1+IndexDrop":{"let":[{"data":{"object":{}}},{"ref":{"object":{}}},{"name":{"select":"name","from":{"var":"params"},"default":null}},{"_inputs":{"object":{"name":{"select":"name","from":{"var":"params"},"default":null}}}},{"annotate":{"object":{}}}],"in":{"let":[{"ctx":{"object":{}}},{"ctx":{"object":{"identity":{"select":"identity","from":{"var":"ctx"},"default":null},"session":{"select":"session","from":{"var":"ctx"},"default":null},"callstack":{"if":{"is_string":"biota.core@0.0.1+IndexDrop"},"then":{"prepend":{"select":"callstack","from":{"var":"ctx"},"default":[]},"collection":["biota.core@0.0.1+IndexDrop"]},"else":{"select":"callstack","from":{"var":"ctx"},"default":[]}},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"success":{"select":"success","from":{"var":"ctx"},"default":true}}}}],"in":{"let":[{"ref":{"index":{"var":"name"}}},{"valid":{"select":"response","from":{"call":"biota.schema@0.0.1+ValidateThrow","arguments":[{"var":"ctx"},{"object":{"code":"instance_not_found","value":{"var":"ref"},"options":{"object":{"type":"index"}},"state":{"object":{}}}}]},"default":{"object":{}}}}],"in":{"let":[{"response":{"if":{"select":"valid","from":{"select":"response","from":{"call":"biota.schema@0.0.1+Validate","arguments":[{"var":"ctx"},{"object":{"value":{"var":"ref"},"options":{"object":{"type":"index"}},"state":{"object":{}}}}]},"default":{"object":{}}},"default":false},"then":{"select":"response","from":{"call":"biota.core@0.0.1+IndexForget","arguments":[{"var":"ctx"},{"object":{"name":{"var":"name"}}}]},"default":{"object":{}}},"else":{"object":{}}}}],"in":{"object":{"response":{"var":"response"},"success":{"select":"success","from":{"var":"ctx"},"default":true},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"ts":{"now":null}}}}}}}}],"in":{"var":"biota.core@0.0.1+IndexDrop"}}}}}}}}}},{"object":{"name":"biota.core@0.0.1+IndexExpire","expression":{"if":{"exists":{"function":"biota.core@0.0.1+IndexExpire"}},"then":{"replace":{"function":"biota.core@0.0.1+IndexExpire"},"params":{"object":{"name":"biota.core@0.0.1+IndexExpire","body":{"query":{"lambda":["ctx","params"],"expr":{"let":[{"biota.core@0.0.1+IndexExpire":{"let":[{"data":{"object":{}}},{"ref":{"object":{}}},{"name":{"select":"name","from":{"var":"params"},"default":null}},{"at":{"select":"at","from":{"var":"params"},"default":{"now":null}}},{"_inputs":{"object":{"name":{"select":"name","from":{"var":"params"},"default":null},"at":{"select":"at","from":{"var":"params"},"default":{"now":null}}}}},{"annotate":{"object":{}}}],"in":{"let":[{"ctx":{"object":{}}},{"ctx":{"object":{"identity":{"select":"identity","from":{"var":"ctx"},"default":null},"session":{"select":"session","from":{"var":"ctx"},"default":null},"callstack":{"if":{"is_string":"biota.core@0.0.1+IndexExpire"},"then":{"prepend":{"select":"callstack","from":{"var":"ctx"},"default":[]},"collection":["biota.core@0.0.1+IndexExpire"]},"else":{"select":"callstack","from":{"var":"ctx"},"default":[]}},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"success":{"select":"success","from":{"var":"ctx"},"default":true}}}}],"in":{"let":[{"isTime":{"select":"response","from":{"call":"biota.schema@0.0.1+ValidateThrow","arguments":[{"var":"ctx"},{"object":{"code":"data_validation_failed","value":{"var":"at"},"options":{"object":{"type":"time"}},"state":{"object":{}}}}]},"default":{"object":{}}}},{"ref":{"index":{"var":"name"}}},{"valid":{"select":"response","from":{"call":"biota.schema@0.0.1+ValidateThrow","arguments":[{"var":"ctx"},{"object":{"code":"instance_not_found","value":{"var":"ref"},"options":{"object":{"type":"index"}},"state":{"object":{}}}}]},"default":{"object":{}}}},{"annotate":{"object":{"at":{"var":"at"}}}}],"in":{"let":[{"annotationName":"expire"},{"annotationData":{"var":"data"}},{"annotationInputs":{"var":"annotate"}},{"data":{"select":"response","from":{"call":"biota.builder@0.0.1+Annotate","arguments":[{"var":"ctx"},{"object":{"action":{"var":"annotationName"},"data":{"var":"annotationData"},"input":{"var":"annotationInputs"}}}]},"default":{"object":{}}}}],"in":{"let":[{"response":{"select":"response","from":{"call":"biota.core@0.0.1+IndexUpsert","arguments":[{"var":"ctx"},{"object":{"name":{"var":"name"},"options":{"object":{"data":{"var":"data"}}}}}]},"default":{"object":{}}}}],"in":{"let":[{"actionName":"expire"},{"actionRef":{"select":"ref","from":{"var":"response"},"default":null}},{"data":{"if":{"not":{"is_null":{"var":"actionRef"}}},"then":{"select":"response","from":{"call":"biota.builder@0.0.1+ActionLog","arguments":[{"var":"ctx"},{"object":{"name":{"var":"actionName"},"instance":{"var":"actionRef"}}}]},"default":{"object":{}}},"else":""}}],"in":{"object":{"response":{"var":"response"},"success":{"select":"success","from":{"var":"ctx"},"default":true},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"ts":{"now":null}}}}}}}}}}],"in":{"var":"biota.core@0.0.1+IndexExpire"}}}}}}},"else":{"create_function":{"object":{"name":"biota.core@0.0.1+IndexExpire","body":{"query":{"lambda":["ctx","params"],"expr":{"let":[{"biota.core@0.0.1+IndexExpire":{"let":[{"data":{"object":{}}},{"ref":{"object":{}}},{"name":{"select":"name","from":{"var":"params"},"default":null}},{"at":{"select":"at","from":{"var":"params"},"default":{"now":null}}},{"_inputs":{"object":{"name":{"select":"name","from":{"var":"params"},"default":null},"at":{"select":"at","from":{"var":"params"},"default":{"now":null}}}}},{"annotate":{"object":{}}}],"in":{"let":[{"ctx":{"object":{}}},{"ctx":{"object":{"identity":{"select":"identity","from":{"var":"ctx"},"default":null},"session":{"select":"session","from":{"var":"ctx"},"default":null},"callstack":{"if":{"is_string":"biota.core@0.0.1+IndexExpire"},"then":{"prepend":{"select":"callstack","from":{"var":"ctx"},"default":[]},"collection":["biota.core@0.0.1+IndexExpire"]},"else":{"select":"callstack","from":{"var":"ctx"},"default":[]}},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"success":{"select":"success","from":{"var":"ctx"},"default":true}}}}],"in":{"let":[{"isTime":{"select":"response","from":{"call":"biota.schema@0.0.1+ValidateThrow","arguments":[{"var":"ctx"},{"object":{"code":"data_validation_failed","value":{"var":"at"},"options":{"object":{"type":"time"}},"state":{"object":{}}}}]},"default":{"object":{}}}},{"ref":{"index":{"var":"name"}}},{"valid":{"select":"response","from":{"call":"biota.schema@0.0.1+ValidateThrow","arguments":[{"var":"ctx"},{"object":{"code":"instance_not_found","value":{"var":"ref"},"options":{"object":{"type":"index"}},"state":{"object":{}}}}]},"default":{"object":{}}}},{"annotate":{"object":{"at":{"var":"at"}}}}],"in":{"let":[{"annotationName":"expire"},{"annotationData":{"var":"data"}},{"annotationInputs":{"var":"annotate"}},{"data":{"select":"response","from":{"call":"biota.builder@0.0.1+Annotate","arguments":[{"var":"ctx"},{"object":{"action":{"var":"annotationName"},"data":{"var":"annotationData"},"input":{"var":"annotationInputs"}}}]},"default":{"object":{}}}}],"in":{"let":[{"response":{"select":"response","from":{"call":"biota.core@0.0.1+IndexUpsert","arguments":[{"var":"ctx"},{"object":{"name":{"var":"name"},"options":{"object":{"data":{"var":"data"}}}}}]},"default":{"object":{}}}}],"in":{"let":[{"actionName":"expire"},{"actionRef":{"select":"ref","from":{"var":"response"},"default":null}},{"data":{"if":{"not":{"is_null":{"var":"actionRef"}}},"then":{"select":"response","from":{"call":"biota.builder@0.0.1+ActionLog","arguments":[{"var":"ctx"},{"object":{"name":{"var":"actionName"},"instance":{"var":"actionRef"}}}]},"default":{"object":{}}},"else":""}}],"in":{"object":{"response":{"var":"response"},"success":{"select":"success","from":{"var":"ctx"},"default":true},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"ts":{"now":null}}}}}}}}}}],"in":{"var":"biota.core@0.0.1+IndexExpire"}}}}}}}}}},{"object":{"name":"biota.core@0.0.1+IndexExpireIn","expression":{"if":{"exists":{"function":"biota.core@0.0.1+IndexExpireIn"}},"then":{"replace":{"function":"biota.core@0.0.1+IndexExpireIn"},"params":{"object":{"name":"biota.core@0.0.1+IndexExpireIn","body":{"query":{"lambda":["ctx","params"],"expr":{"let":[{"biota.core@0.0.1+IndexExpireIn":{"let":[{"data":{"object":{}}},{"ref":{"object":{}}},{"name":{"select":"name","from":{"var":"params"},"default":null}},{"delay":{"select":"delay","from":{"var":"params"},"default":0}},{"_inputs":{"object":{"name":{"select":"name","from":{"var":"params"},"default":null},"delay":{"select":"delay","from":{"var":"params"},"default":0}}}},{"annotate":{"object":{}}}],"in":{"let":[{"ctx":{"object":{}}},{"ctx":{"object":{"identity":{"select":"identity","from":{"var":"ctx"},"default":null},"session":{"select":"session","from":{"var":"ctx"},"default":null},"callstack":{"if":{"is_string":"biota.core@0.0.1+IndexExpireIn"},"then":{"prepend":{"select":"callstack","from":{"var":"ctx"},"default":[]},"collection":["biota.core@0.0.1+IndexExpireIn"]},"else":{"select":"callstack","from":{"var":"ctx"},"default":[]}},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"success":{"select":"success","from":{"var":"ctx"},"default":true}}}}],"in":{"let":[{"response":{"select":"response","from":{"call":"biota.core@0.0.1+IndexExpire","arguments":[{"var":"ctx"},{"object":{"name":{"var":"name"},"at":{"time_add":{"now":null},"offset":{"to_number":{"var":"delay"}},"unit":"milliseconds"}}}]},"default":{"object":{}}}}],"in":{"object":{"response":{"var":"response"},"success":{"select":"success","from":{"var":"ctx"},"default":true},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"ts":{"now":null}}}}}}}],"in":{"var":"biota.core@0.0.1+IndexExpireIn"}}}}}}},"else":{"create_function":{"object":{"name":"biota.core@0.0.1+IndexExpireIn","body":{"query":{"lambda":["ctx","params"],"expr":{"let":[{"biota.core@0.0.1+IndexExpireIn":{"let":[{"data":{"object":{}}},{"ref":{"object":{}}},{"name":{"select":"name","from":{"var":"params"},"default":null}},{"delay":{"select":"delay","from":{"var":"params"},"default":0}},{"_inputs":{"object":{"name":{"select":"name","from":{"var":"params"},"default":null},"delay":{"select":"delay","from":{"var":"params"},"default":0}}}},{"annotate":{"object":{}}}],"in":{"let":[{"ctx":{"object":{}}},{"ctx":{"object":{"identity":{"select":"identity","from":{"var":"ctx"},"default":null},"session":{"select":"session","from":{"var":"ctx"},"default":null},"callstack":{"if":{"is_string":"biota.core@0.0.1+IndexExpireIn"},"then":{"prepend":{"select":"callstack","from":{"var":"ctx"},"default":[]},"collection":["biota.core@0.0.1+IndexExpireIn"]},"else":{"select":"callstack","from":{"var":"ctx"},"default":[]}},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"success":{"select":"success","from":{"var":"ctx"},"default":true}}}}],"in":{"let":[{"response":{"select":"response","from":{"call":"biota.core@0.0.1+IndexExpire","arguments":[{"var":"ctx"},{"object":{"name":{"var":"name"},"at":{"time_add":{"now":null},"offset":{"to_number":{"var":"delay"}},"unit":"milliseconds"}}}]},"default":{"object":{}}}}],"in":{"object":{"response":{"var":"response"},"success":{"select":"success","from":{"var":"ctx"},"default":true},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"ts":{"now":null}}}}}}}],"in":{"var":"biota.core@0.0.1+IndexExpireIn"}}}}}}}}}},{"object":{"name":"biota.core@0.0.1+IndexExpireNow","expression":{"if":{"exists":{"function":"biota.core@0.0.1+IndexExpireNow"}},"then":{"replace":{"function":"biota.core@0.0.1+IndexExpireNow"},"params":{"object":{"name":"biota.core@0.0.1+IndexExpireNow","body":{"query":{"lambda":["ctx","params"],"expr":{"let":[{"biota.core@0.0.1+IndexExpireNow":{"let":[{"data":{"object":{}}},{"ref":{"object":{}}},{"name":{"select":"name","from":{"var":"params"},"default":null}},{"_inputs":{"object":{"name":{"select":"name","from":{"var":"params"},"default":null}}}},{"annotate":{"object":{}}}],"in":{"let":[{"ctx":{"object":{}}},{"ctx":{"object":{"identity":{"select":"identity","from":{"var":"ctx"},"default":null},"session":{"select":"session","from":{"var":"ctx"},"default":null},"callstack":{"if":{"is_string":"biota.core@0.0.1+IndexExpireNow"},"then":{"prepend":{"select":"callstack","from":{"var":"ctx"},"default":[]},"collection":["biota.core@0.0.1+IndexExpireNow"]},"else":{"select":"callstack","from":{"var":"ctx"},"default":[]}},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"success":{"select":"success","from":{"var":"ctx"},"default":true}}}}],"in":{"let":[{"response":{"select":"response","from":{"call":"biota.core@0.0.1+IndexExpire","arguments":[{"var":"ctx"},{"object":{"name":{"var":"name"},"at":{"now":null}}}]},"default":{"object":{}}}}],"in":{"object":{"response":{"var":"response"},"success":{"select":"success","from":{"var":"ctx"},"default":true},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"ts":{"now":null}}}}}}}],"in":{"var":"biota.core@0.0.1+IndexExpireNow"}}}}}}},"else":{"create_function":{"object":{"name":"biota.core@0.0.1+IndexExpireNow","body":{"query":{"lambda":["ctx","params"],"expr":{"let":[{"biota.core@0.0.1+IndexExpireNow":{"let":[{"data":{"object":{}}},{"ref":{"object":{}}},{"name":{"select":"name","from":{"var":"params"},"default":null}},{"_inputs":{"object":{"name":{"select":"name","from":{"var":"params"},"default":null}}}},{"annotate":{"object":{}}}],"in":{"let":[{"ctx":{"object":{}}},{"ctx":{"object":{"identity":{"select":"identity","from":{"var":"ctx"},"default":null},"session":{"select":"session","from":{"var":"ctx"},"default":null},"callstack":{"if":{"is_string":"biota.core@0.0.1+IndexExpireNow"},"then":{"prepend":{"select":"callstack","from":{"var":"ctx"},"default":[]},"collection":["biota.core@0.0.1+IndexExpireNow"]},"else":{"select":"callstack","from":{"var":"ctx"},"default":[]}},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"success":{"select":"success","from":{"var":"ctx"},"default":true}}}}],"in":{"let":[{"response":{"select":"response","from":{"call":"biota.core@0.0.1+IndexExpire","arguments":[{"var":"ctx"},{"object":{"name":{"var":"name"},"at":{"now":null}}}]},"default":{"object":{}}}}],"in":{"object":{"response":{"var":"response"},"success":{"select":"success","from":{"var":"ctx"},"default":true},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"ts":{"now":null}}}}}}}],"in":{"var":"biota.core@0.0.1+IndexExpireNow"}}}}}}}}}},{"object":{"name":"biota.core@0.0.1+IndexesGetAll","expression":{"if":{"exists":{"function":"biota.core@0.0.1+IndexesGetAll"}},"then":{"replace":{"function":"biota.core@0.0.1+IndexesGetAll"},"params":{"object":{"name":"biota.core@0.0.1+IndexesGetAll","body":{"query":{"lambda":["ctx","params"],"expr":{"let":[{"biota.core@0.0.1+IndexesGetAll":{"let":[{"data":{"object":{}}},{"ref":{"object":{}}},{"pagination":{"select":"pagination","from":{"var":"params"},"default":{"object":{}}}},{"_inputs":{"object":{"pagination":{"select":"pagination","from":{"var":"params"},"default":{"object":{}}}}}},{"annotate":{"object":{}}}],"in":{"let":[{"ctx":{"object":{}}},{"ctx":{"object":{"identity":{"select":"identity","from":{"var":"ctx"},"default":null},"session":{"select":"session","from":{"var":"ctx"},"default":null},"callstack":{"if":{"is_string":"biota.core@0.0.1+IndexesGetAll"},"then":{"prepend":{"select":"callstack","from":{"var":"ctx"},"default":[]},"collection":["biota.core@0.0.1+IndexesGetAll"]},"else":{"select":"callstack","from":{"var":"ctx"},"default":[]}},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"success":{"select":"success","from":{"var":"ctx"},"default":true}}}}],"in":{"let":[{"response":{"map":{"lambda":"x","expr":{"get":{"var":"x"}}},"collection":{"if":{"contains":["before"],"in":{"var":"pagination"}},"then":{"paginate":{"indexes":null},"before":{"select":"before","from":{"var":"pagination"},"default":null},"size":{"select":"size","from":{"var":"pagination"},"default":100},"events":{"select":"events","from":{"var":"pagination"},"default":false},"ts":{"select":"ts","from":{"var":"pagination"},"default":{"now":null}}},"else":{"if":{"contains":["after"],"in":{"var":"pagination"}},"then":{"paginate":{"indexes":null},"after":{"select":"after","from":{"var":"pagination"},"default":0},"size":{"select":"size","from":{"var":"pagination"},"default":100},"events":{"select":"events","from":{"var":"pagination"},"default":false},"ts":{"select":"ts","from":{"var":"pagination"},"default":{"now":null}}},"else":{"paginate":{"indexes":null},"size":{"select":"size","from":{"var":"pagination"},"default":100},"events":{"select":"events","from":{"var":"pagination"},"default":false},"ts":{"select":"ts","from":{"var":"pagination"},"default":{"now":null}}}}}}}],"in":{"object":{"response":{"var":"response"},"success":{"select":"success","from":{"var":"ctx"},"default":true},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"ts":{"now":null}}}}}}}],"in":{"var":"biota.core@0.0.1+IndexesGetAll"}}}}}}},"else":{"create_function":{"object":{"name":"biota.core@0.0.1+IndexesGetAll","body":{"query":{"lambda":["ctx","params"],"expr":{"let":[{"biota.core@0.0.1+IndexesGetAll":{"let":[{"data":{"object":{}}},{"ref":{"object":{}}},{"pagination":{"select":"pagination","from":{"var":"params"},"default":{"object":{}}}},{"_inputs":{"object":{"pagination":{"select":"pagination","from":{"var":"params"},"default":{"object":{}}}}}},{"annotate":{"object":{}}}],"in":{"let":[{"ctx":{"object":{}}},{"ctx":{"object":{"identity":{"select":"identity","from":{"var":"ctx"},"default":null},"session":{"select":"session","from":{"var":"ctx"},"default":null},"callstack":{"if":{"is_string":"biota.core@0.0.1+IndexesGetAll"},"then":{"prepend":{"select":"callstack","from":{"var":"ctx"},"default":[]},"collection":["biota.core@0.0.1+IndexesGetAll"]},"else":{"select":"callstack","from":{"var":"ctx"},"default":[]}},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"success":{"select":"success","from":{"var":"ctx"},"default":true}}}}],"in":{"let":[{"response":{"map":{"lambda":"x","expr":{"get":{"var":"x"}}},"collection":{"if":{"contains":["before"],"in":{"var":"pagination"}},"then":{"paginate":{"indexes":null},"before":{"select":"before","from":{"var":"pagination"},"default":null},"size":{"select":"size","from":{"var":"pagination"},"default":100},"events":{"select":"events","from":{"var":"pagination"},"default":false},"ts":{"select":"ts","from":{"var":"pagination"},"default":{"now":null}}},"else":{"if":{"contains":["after"],"in":{"var":"pagination"}},"then":{"paginate":{"indexes":null},"after":{"select":"after","from":{"var":"pagination"},"default":0},"size":{"select":"size","from":{"var":"pagination"},"default":100},"events":{"select":"events","from":{"var":"pagination"},"default":false},"ts":{"select":"ts","from":{"var":"pagination"},"default":{"now":null}}},"else":{"paginate":{"indexes":null},"size":{"select":"size","from":{"var":"pagination"},"default":100},"events":{"select":"events","from":{"var":"pagination"},"default":false},"ts":{"select":"ts","from":{"var":"pagination"},"default":{"now":null}}}}}}}],"in":{"object":{"response":{"var":"response"},"success":{"select":"success","from":{"var":"ctx"},"default":true},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"ts":{"now":null}}}}}}}],"in":{"var":"biota.core@0.0.1+IndexesGetAll"}}}}}}}}}},{"object":{"name":"biota.core@0.0.1+IndexesGetMany","expression":{"if":{"exists":{"function":"biota.core@0.0.1+IndexesGetMany"}},"then":{"replace":{"function":"biota.core@0.0.1+IndexesGetMany"},"params":{"object":{"name":"biota.core@0.0.1+IndexesGetMany","body":{"query":{"lambda":["ctx","params"],"expr":{"let":[{"biota.core@0.0.1+IndexesGetMany":{"let":[{"data":{"object":{}}},{"ref":{"object":{}}},{"namesList":{"select":"namesList","from":{"var":"params"},"default":[]}},{"_inputs":{"object":{"namesList":{"select":"namesList","from":{"var":"params"},"default":[]}}}},{"annotate":{"object":{}}}],"in":{"let":[{"ctx":{"object":{}}},{"ctx":{"object":{"identity":{"select":"identity","from":{"var":"ctx"},"default":null},"session":{"select":"session","from":{"var":"ctx"},"default":null},"callstack":{"if":{"is_string":"biota.core@0.0.1+IndexesGetMany"},"then":{"prepend":{"select":"callstack","from":{"var":"ctx"},"default":[]},"collection":["biota.core@0.0.1+IndexesGetMany"]},"else":{"select":"callstack","from":{"var":"ctx"},"default":[]}},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"success":{"select":"success","from":{"var":"ctx"},"default":true}}}}],"in":{"let":[{"response":{"map":{"lambda":["name"],"expr":{"select":"response","from":{"call":"biota.core@0.0.1+IndexGet","arguments":[{"var":"ctx"},{"object":{"name":{"var":"name"}}}]},"default":{"object":{}}}},"collection":{"var":"namesList"}}}],"in":{"object":{"response":{"var":"response"},"success":{"select":"success","from":{"var":"ctx"},"default":true},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"ts":{"now":null}}}}}}}],"in":{"var":"biota.core@0.0.1+IndexesGetMany"}}}}}}},"else":{"create_function":{"object":{"name":"biota.core@0.0.1+IndexesGetMany","body":{"query":{"lambda":["ctx","params"],"expr":{"let":[{"biota.core@0.0.1+IndexesGetMany":{"let":[{"data":{"object":{}}},{"ref":{"object":{}}},{"namesList":{"select":"namesList","from":{"var":"params"},"default":[]}},{"_inputs":{"object":{"namesList":{"select":"namesList","from":{"var":"params"},"default":[]}}}},{"annotate":{"object":{}}}],"in":{"let":[{"ctx":{"object":{}}},{"ctx":{"object":{"identity":{"select":"identity","from":{"var":"ctx"},"default":null},"session":{"select":"session","from":{"var":"ctx"},"default":null},"callstack":{"if":{"is_string":"biota.core@0.0.1+IndexesGetMany"},"then":{"prepend":{"select":"callstack","from":{"var":"ctx"},"default":[]},"collection":["biota.core@0.0.1+IndexesGetMany"]},"else":{"select":"callstack","from":{"var":"ctx"},"default":[]}},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"success":{"select":"success","from":{"var":"ctx"},"default":true}}}}],"in":{"let":[{"response":{"map":{"lambda":["name"],"expr":{"select":"response","from":{"call":"biota.core@0.0.1+IndexGet","arguments":[{"var":"ctx"},{"object":{"name":{"var":"name"}}}]},"default":{"object":{}}}},"collection":{"var":"namesList"}}}],"in":{"object":{"response":{"var":"response"},"success":{"select":"success","from":{"var":"ctx"},"default":true},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"ts":{"now":null}}}}}}}],"in":{"var":"biota.core@0.0.1+IndexesGetMany"}}}}}}}}}},{"object":{"name":"biota.core@0.0.1+IndexesInsertMany","expression":{"if":{"exists":{"function":"biota.core@0.0.1+IndexesInsertMany"}},"then":{"replace":{"function":"biota.core@0.0.1+IndexesInsertMany"},"params":{"object":{"name":"biota.core@0.0.1+IndexesInsertMany","body":{"query":{"lambda":["ctx","params"],"expr":{"let":[{"biota.core@0.0.1+IndexesInsertMany":{"let":[{"data":{"object":{}}},{"ref":{"object":{}}},{"optionsList":{"select":"optionsList","from":{"var":"params"},"default":[]}},{"_inputs":{"object":{"optionsList":{"select":"optionsList","from":{"var":"params"},"default":[]}}}},{"annotate":{"object":{}}}],"in":{"let":[{"ctx":{"object":{}}},{"ctx":{"object":{"identity":{"select":"identity","from":{"var":"ctx"},"default":null},"session":{"select":"session","from":{"var":"ctx"},"default":null},"callstack":{"if":{"is_string":"biota.core@0.0.1+IndexesInsertMany"},"then":{"prepend":{"select":"callstack","from":{"var":"ctx"},"default":[]},"collection":["biota.core@0.0.1+IndexesInsertMany"]},"else":{"select":"callstack","from":{"var":"ctx"},"default":[]}},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"success":{"select":"success","from":{"var":"ctx"},"default":true}}}}],"in":{"let":[{"response":{"map":{"lambda":["definition"],"expr":{"select":"response","from":{"call":"biota.core@0.0.1+IndexInsert","arguments":[{"var":"ctx"},{"object":{"name":null,"options":{"var":"definition"}}}]},"default":{"object":{}}}},"collection":{"var":"optionsList"}}}],"in":{"object":{"response":{"var":"response"},"success":{"select":"success","from":{"var":"ctx"},"default":true},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"ts":{"now":null}}}}}}}],"in":{"var":"biota.core@0.0.1+IndexesInsertMany"}}}}}}},"else":{"create_function":{"object":{"name":"biota.core@0.0.1+IndexesInsertMany","body":{"query":{"lambda":["ctx","params"],"expr":{"let":[{"biota.core@0.0.1+IndexesInsertMany":{"let":[{"data":{"object":{}}},{"ref":{"object":{}}},{"optionsList":{"select":"optionsList","from":{"var":"params"},"default":[]}},{"_inputs":{"object":{"optionsList":{"select":"optionsList","from":{"var":"params"},"default":[]}}}},{"annotate":{"object":{}}}],"in":{"let":[{"ctx":{"object":{}}},{"ctx":{"object":{"identity":{"select":"identity","from":{"var":"ctx"},"default":null},"session":{"select":"session","from":{"var":"ctx"},"default":null},"callstack":{"if":{"is_string":"biota.core@0.0.1+IndexesInsertMany"},"then":{"prepend":{"select":"callstack","from":{"var":"ctx"},"default":[]},"collection":["biota.core@0.0.1+IndexesInsertMany"]},"else":{"select":"callstack","from":{"var":"ctx"},"default":[]}},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"success":{"select":"success","from":{"var":"ctx"},"default":true}}}}],"in":{"let":[{"response":{"map":{"lambda":["definition"],"expr":{"select":"response","from":{"call":"biota.core@0.0.1+IndexInsert","arguments":[{"var":"ctx"},{"object":{"name":null,"options":{"var":"definition"}}}]},"default":{"object":{}}}},"collection":{"var":"optionsList"}}}],"in":{"object":{"response":{"var":"response"},"success":{"select":"success","from":{"var":"ctx"},"default":true},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"ts":{"now":null}}}}}}}],"in":{"var":"biota.core@0.0.1+IndexesInsertMany"}}}}}}}}}},{"object":{"name":"biota.core@0.0.1+IndexesUpdateMany","expression":{"if":{"exists":{"function":"biota.core@0.0.1+IndexesUpdateMany"}},"then":{"replace":{"function":"biota.core@0.0.1+IndexesUpdateMany"},"params":{"object":{"name":"biota.core@0.0.1+IndexesUpdateMany","body":{"query":{"lambda":["ctx","params"],"expr":{"let":[{"biota.core@0.0.1+IndexesUpdateMany":{"let":[{"data":{"object":{}}},{"ref":{"object":{}}},{"optionsList":{"select":"optionsList","from":{"var":"params"},"default":[]}},{"_inputs":{"object":{"optionsList":{"select":"optionsList","from":{"var":"params"},"default":[]}}}},{"annotate":{"object":{}}}],"in":{"let":[{"ctx":{"object":{}}},{"ctx":{"object":{"identity":{"select":"identity","from":{"var":"ctx"},"default":null},"session":{"select":"session","from":{"var":"ctx"},"default":null},"callstack":{"if":{"is_string":"biota.core@0.0.1+IndexesUpdateMany"},"then":{"prepend":{"select":"callstack","from":{"var":"ctx"},"default":[]},"collection":["biota.core@0.0.1+IndexesUpdateMany"]},"else":{"select":"callstack","from":{"var":"ctx"},"default":[]}},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"success":{"select":"success","from":{"var":"ctx"},"default":true}}}}],"in":{"let":[{"response":{"map":{"lambda":["definition"],"expr":{"select":"response","from":{"call":"biota.core@0.0.1+IndexUpdate","arguments":[{"var":"ctx"},{"object":{"name":null,"options":{"var":"definition"}}}]},"default":{"object":{}}}},"collection":{"var":"optionsList"}}}],"in":{"object":{"response":{"var":"response"},"success":{"select":"success","from":{"var":"ctx"},"default":true},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"ts":{"now":null}}}}}}}],"in":{"var":"biota.core@0.0.1+IndexesUpdateMany"}}}}}}},"else":{"create_function":{"object":{"name":"biota.core@0.0.1+IndexesUpdateMany","body":{"query":{"lambda":["ctx","params"],"expr":{"let":[{"biota.core@0.0.1+IndexesUpdateMany":{"let":[{"data":{"object":{}}},{"ref":{"object":{}}},{"optionsList":{"select":"optionsList","from":{"var":"params"},"default":[]}},{"_inputs":{"object":{"optionsList":{"select":"optionsList","from":{"var":"params"},"default":[]}}}},{"annotate":{"object":{}}}],"in":{"let":[{"ctx":{"object":{}}},{"ctx":{"object":{"identity":{"select":"identity","from":{"var":"ctx"},"default":null},"session":{"select":"session","from":{"var":"ctx"},"default":null},"callstack":{"if":{"is_string":"biota.core@0.0.1+IndexesUpdateMany"},"then":{"prepend":{"select":"callstack","from":{"var":"ctx"},"default":[]},"collection":["biota.core@0.0.1+IndexesUpdateMany"]},"else":{"select":"callstack","from":{"var":"ctx"},"default":[]}},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"success":{"select":"success","from":{"var":"ctx"},"default":true}}}}],"in":{"let":[{"response":{"map":{"lambda":["definition"],"expr":{"select":"response","from":{"call":"biota.core@0.0.1+IndexUpdate","arguments":[{"var":"ctx"},{"object":{"name":null,"options":{"var":"definition"}}}]},"default":{"object":{}}}},"collection":{"var":"optionsList"}}}],"in":{"object":{"response":{"var":"response"},"success":{"select":"success","from":{"var":"ctx"},"default":true},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"ts":{"now":null}}}}}}}],"in":{"var":"biota.core@0.0.1+IndexesUpdateMany"}}}}}}}}}},{"object":{"name":"biota.core@0.0.1+IndexesUpsertMany","expression":{"if":{"exists":{"function":"biota.core@0.0.1+IndexesUpsertMany"}},"then":{"replace":{"function":"biota.core@0.0.1+IndexesUpsertMany"},"params":{"object":{"name":"biota.core@0.0.1+IndexesUpsertMany","body":{"query":{"lambda":["ctx","params"],"expr":{"let":[{"biota.core@0.0.1+IndexesUpsertMany":{"let":[{"data":{"object":{}}},{"ref":{"object":{}}},{"optionsList":{"select":"optionsList","from":{"var":"params"},"default":[]}},{"_inputs":{"object":{"optionsList":{"select":"optionsList","from":{"var":"params"},"default":[]}}}},{"annotate":{"object":{}}}],"in":{"let":[{"ctx":{"object":{}}},{"ctx":{"object":{"identity":{"select":"identity","from":{"var":"ctx"},"default":null},"session":{"select":"session","from":{"var":"ctx"},"default":null},"callstack":{"if":{"is_string":"biota.core@0.0.1+IndexesUpsertMany"},"then":{"prepend":{"select":"callstack","from":{"var":"ctx"},"default":[]},"collection":["biota.core@0.0.1+IndexesUpsertMany"]},"else":{"select":"callstack","from":{"var":"ctx"},"default":[]}},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"success":{"select":"success","from":{"var":"ctx"},"default":true}}}}],"in":{"let":[{"response":{"map":{"lambda":["definition"],"expr":{"select":"response","from":{"call":"biota.core@0.0.1+IndexUpsert","arguments":[{"var":"ctx"},{"object":{"name":null,"options":{"var":"definition"}}}]},"default":{"object":{}}}},"collection":{"var":"optionsList"}}}],"in":{"object":{"response":{"var":"response"},"success":{"select":"success","from":{"var":"ctx"},"default":true},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"ts":{"now":null}}}}}}}],"in":{"var":"biota.core@0.0.1+IndexesUpsertMany"}}}}}}},"else":{"create_function":{"object":{"name":"biota.core@0.0.1+IndexesUpsertMany","body":{"query":{"lambda":["ctx","params"],"expr":{"let":[{"biota.core@0.0.1+IndexesUpsertMany":{"let":[{"data":{"object":{}}},{"ref":{"object":{}}},{"optionsList":{"select":"optionsList","from":{"var":"params"},"default":[]}},{"_inputs":{"object":{"optionsList":{"select":"optionsList","from":{"var":"params"},"default":[]}}}},{"annotate":{"object":{}}}],"in":{"let":[{"ctx":{"object":{}}},{"ctx":{"object":{"identity":{"select":"identity","from":{"var":"ctx"},"default":null},"session":{"select":"session","from":{"var":"ctx"},"default":null},"callstack":{"if":{"is_string":"biota.core@0.0.1+IndexesUpsertMany"},"then":{"prepend":{"select":"callstack","from":{"var":"ctx"},"default":[]},"collection":["biota.core@0.0.1+IndexesUpsertMany"]},"else":{"select":"callstack","from":{"var":"ctx"},"default":[]}},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"success":{"select":"success","from":{"var":"ctx"},"default":true}}}}],"in":{"let":[{"response":{"map":{"lambda":["definition"],"expr":{"select":"response","from":{"call":"biota.core@0.0.1+IndexUpsert","arguments":[{"var":"ctx"},{"object":{"name":null,"options":{"var":"definition"}}}]},"default":{"object":{}}}},"collection":{"var":"optionsList"}}}],"in":{"object":{"response":{"var":"response"},"success":{"select":"success","from":{"var":"ctx"},"default":true},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"ts":{"now":null}}}}}}}],"in":{"var":"biota.core@0.0.1+IndexesUpsertMany"}}}}}}}}}},{"object":{"name":"biota.core@0.0.1+IndexesReplaceMany","expression":{"if":{"exists":{"function":"biota.core@0.0.1+IndexesReplaceMany"}},"then":{"replace":{"function":"biota.core@0.0.1+IndexesReplaceMany"},"params":{"object":{"name":"biota.core@0.0.1+IndexesReplaceMany","body":{"query":{"lambda":["ctx","params"],"expr":{"let":[{"biota.core@0.0.1+IndexesReplaceMany":{"let":[{"data":{"object":{}}},{"ref":{"object":{}}},{"optionsList":{"select":"optionsList","from":{"var":"params"},"default":[]}},{"_inputs":{"object":{"optionsList":{"select":"optionsList","from":{"var":"params"},"default":[]}}}},{"annotate":{"object":{}}}],"in":{"let":[{"ctx":{"object":{}}},{"ctx":{"object":{"identity":{"select":"identity","from":{"var":"ctx"},"default":null},"session":{"select":"session","from":{"var":"ctx"},"default":null},"callstack":{"if":{"is_string":"biota.core@0.0.1+IndexesReplaceMany"},"then":{"prepend":{"select":"callstack","from":{"var":"ctx"},"default":[]},"collection":["biota.core@0.0.1+IndexesReplaceMany"]},"else":{"select":"callstack","from":{"var":"ctx"},"default":[]}},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"success":{"select":"success","from":{"var":"ctx"},"default":true}}}}],"in":{"let":[{"response":{"map":{"lambda":["definition"],"expr":{"select":"response","from":{"call":"biota.core@0.0.1+IndexReplace","arguments":[{"var":"ctx"},{"object":{"name":null,"options":{"var":"definition"}}}]},"default":{"object":{}}}},"collection":{"var":"optionsList"}}}],"in":{"object":{"response":{"var":"response"},"success":{"select":"success","from":{"var":"ctx"},"default":true},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"ts":{"now":null}}}}}}}],"in":{"var":"biota.core@0.0.1+IndexesReplaceMany"}}}}}}},"else":{"create_function":{"object":{"name":"biota.core@0.0.1+IndexesReplaceMany","body":{"query":{"lambda":["ctx","params"],"expr":{"let":[{"biota.core@0.0.1+IndexesReplaceMany":{"let":[{"data":{"object":{}}},{"ref":{"object":{}}},{"optionsList":{"select":"optionsList","from":{"var":"params"},"default":[]}},{"_inputs":{"object":{"optionsList":{"select":"optionsList","from":{"var":"params"},"default":[]}}}},{"annotate":{"object":{}}}],"in":{"let":[{"ctx":{"object":{}}},{"ctx":{"object":{"identity":{"select":"identity","from":{"var":"ctx"},"default":null},"session":{"select":"session","from":{"var":"ctx"},"default":null},"callstack":{"if":{"is_string":"biota.core@0.0.1+IndexesReplaceMany"},"then":{"prepend":{"select":"callstack","from":{"var":"ctx"},"default":[]},"collection":["biota.core@0.0.1+IndexesReplaceMany"]},"else":{"select":"callstack","from":{"var":"ctx"},"default":[]}},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"success":{"select":"success","from":{"var":"ctx"},"default":true}}}}],"in":{"let":[{"response":{"map":{"lambda":["definition"],"expr":{"select":"response","from":{"call":"biota.core@0.0.1+IndexReplace","arguments":[{"var":"ctx"},{"object":{"name":null,"options":{"var":"definition"}}}]},"default":{"object":{}}}},"collection":{"var":"optionsList"}}}],"in":{"object":{"response":{"var":"response"},"success":{"select":"success","from":{"var":"ctx"},"default":true},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"ts":{"now":null}}}}}}}],"in":{"var":"biota.core@0.0.1+IndexesReplaceMany"}}}}}}}}}},{"object":{"name":"biota.core@0.0.1+IndexesRepsertMany","expression":{"if":{"exists":{"function":"biota.core@0.0.1+IndexesRepsertMany"}},"then":{"replace":{"function":"biota.core@0.0.1+IndexesRepsertMany"},"params":{"object":{"name":"biota.core@0.0.1+IndexesRepsertMany","body":{"query":{"lambda":["ctx","params"],"expr":{"let":[{"biota.core@0.0.1+IndexesRepsertMany":{"let":[{"data":{"object":{}}},{"ref":{"object":{}}},{"optionsList":{"select":"optionsList","from":{"var":"params"},"default":[]}},{"_inputs":{"object":{"optionsList":{"select":"optionsList","from":{"var":"params"},"default":[]}}}},{"annotate":{"object":{}}}],"in":{"let":[{"ctx":{"object":{}}},{"ctx":{"object":{"identity":{"select":"identity","from":{"var":"ctx"},"default":null},"session":{"select":"session","from":{"var":"ctx"},"default":null},"callstack":{"if":{"is_string":"biota.core@0.0.1+IndexesRepsertMany"},"then":{"prepend":{"select":"callstack","from":{"var":"ctx"},"default":[]},"collection":["biota.core@0.0.1+IndexesRepsertMany"]},"else":{"select":"callstack","from":{"var":"ctx"},"default":[]}},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"success":{"select":"success","from":{"var":"ctx"},"default":true}}}}],"in":{"let":[{"response":{"map":{"lambda":["definition"],"expr":{"select":"response","from":{"call":"biota.core@0.0.1+IndexRepsert","arguments":[{"var":"ctx"},{"object":{"name":null,"options":{"var":"definition"}}}]},"default":{"object":{}}}},"collection":{"var":"optionsList"}}}],"in":{"object":{"response":{"var":"response"},"success":{"select":"success","from":{"var":"ctx"},"default":true},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"ts":{"now":null}}}}}}}],"in":{"var":"biota.core@0.0.1+IndexesRepsertMany"}}}}}}},"else":{"create_function":{"object":{"name":"biota.core@0.0.1+IndexesRepsertMany","body":{"query":{"lambda":["ctx","params"],"expr":{"let":[{"biota.core@0.0.1+IndexesRepsertMany":{"let":[{"data":{"object":{}}},{"ref":{"object":{}}},{"optionsList":{"select":"optionsList","from":{"var":"params"},"default":[]}},{"_inputs":{"object":{"optionsList":{"select":"optionsList","from":{"var":"params"},"default":[]}}}},{"annotate":{"object":{}}}],"in":{"let":[{"ctx":{"object":{}}},{"ctx":{"object":{"identity":{"select":"identity","from":{"var":"ctx"},"default":null},"session":{"select":"session","from":{"var":"ctx"},"default":null},"callstack":{"if":{"is_string":"biota.core@0.0.1+IndexesRepsertMany"},"then":{"prepend":{"select":"callstack","from":{"var":"ctx"},"default":[]},"collection":["biota.core@0.0.1+IndexesRepsertMany"]},"else":{"select":"callstack","from":{"var":"ctx"},"default":[]}},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"success":{"select":"success","from":{"var":"ctx"},"default":true}}}}],"in":{"let":[{"response":{"map":{"lambda":["definition"],"expr":{"select":"response","from":{"call":"biota.core@0.0.1+IndexRepsert","arguments":[{"var":"ctx"},{"object":{"name":null,"options":{"var":"definition"}}}]},"default":{"object":{}}}},"collection":{"var":"optionsList"}}}],"in":{"object":{"response":{"var":"response"},"success":{"select":"success","from":{"var":"ctx"},"default":true},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"ts":{"now":null}}}}}}}],"in":{"var":"biota.core@0.0.1+IndexesRepsertMany"}}}}}}}}}},{"object":{"name":"biota.core@0.0.1+IndexesDeleteMany","expression":{"if":{"exists":{"function":"biota.core@0.0.1+IndexesDeleteMany"}},"then":{"replace":{"function":"biota.core@0.0.1+IndexesDeleteMany"},"params":{"object":{"name":"biota.core@0.0.1+IndexesDeleteMany","body":{"query":{"lambda":["ctx","params"],"expr":{"let":[{"biota.core@0.0.1+IndexesDeleteMany":{"let":[{"data":{"object":{}}},{"ref":{"object":{}}},{"namesList":{"select":"namesList","from":{"var":"params"},"default":[]}},{"_inputs":{"object":{"namesList":{"select":"namesList","from":{"var":"params"},"default":[]}}}},{"annotate":{"object":{}}}],"in":{"let":[{"ctx":{"object":{}}},{"ctx":{"object":{"identity":{"select":"identity","from":{"var":"ctx"},"default":null},"session":{"select":"session","from":{"var":"ctx"},"default":null},"callstack":{"if":{"is_string":"biota.core@0.0.1+IndexesDeleteMany"},"then":{"prepend":{"select":"callstack","from":{"var":"ctx"},"default":[]},"collection":["biota.core@0.0.1+IndexesDeleteMany"]},"else":{"select":"callstack","from":{"var":"ctx"},"default":[]}},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"success":{"select":"success","from":{"var":"ctx"},"default":true}}}}],"in":{"let":[{"response":{"map":{"lambda":["name"],"expr":{"select":"response","from":{"call":"biota.core@0.0.1+IndexDelete","arguments":[{"var":"ctx"},{"object":{"name":{"var":"name"}}}]},"default":{"object":{}}}},"collection":{"var":"namesList"}}}],"in":{"object":{"response":{"var":"response"},"success":{"select":"success","from":{"var":"ctx"},"default":true},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"ts":{"now":null}}}}}}}],"in":{"var":"biota.core@0.0.1+IndexesDeleteMany"}}}}}}},"else":{"create_function":{"object":{"name":"biota.core@0.0.1+IndexesDeleteMany","body":{"query":{"lambda":["ctx","params"],"expr":{"let":[{"biota.core@0.0.1+IndexesDeleteMany":{"let":[{"data":{"object":{}}},{"ref":{"object":{}}},{"namesList":{"select":"namesList","from":{"var":"params"},"default":[]}},{"_inputs":{"object":{"namesList":{"select":"namesList","from":{"var":"params"},"default":[]}}}},{"annotate":{"object":{}}}],"in":{"let":[{"ctx":{"object":{}}},{"ctx":{"object":{"identity":{"select":"identity","from":{"var":"ctx"},"default":null},"session":{"select":"session","from":{"var":"ctx"},"default":null},"callstack":{"if":{"is_string":"biota.core@0.0.1+IndexesDeleteMany"},"then":{"prepend":{"select":"callstack","from":{"var":"ctx"},"default":[]},"collection":["biota.core@0.0.1+IndexesDeleteMany"]},"else":{"select":"callstack","from":{"var":"ctx"},"default":[]}},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"success":{"select":"success","from":{"var":"ctx"},"default":true}}}}],"in":{"let":[{"response":{"map":{"lambda":["name"],"expr":{"select":"response","from":{"call":"biota.core@0.0.1+IndexDelete","arguments":[{"var":"ctx"},{"object":{"name":{"var":"name"}}}]},"default":{"object":{}}}},"collection":{"var":"namesList"}}}],"in":{"object":{"response":{"var":"response"},"success":{"select":"success","from":{"var":"ctx"},"default":true},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"ts":{"now":null}}}}}}}],"in":{"var":"biota.core@0.0.1+IndexesDeleteMany"}}}}}}}}}},{"object":{"name":"biota.core@0.0.1+IndexesRestoreMany","expression":{"if":{"exists":{"function":"biota.core@0.0.1+IndexesRestoreMany"}},"then":{"replace":{"function":"biota.core@0.0.1+IndexesRestoreMany"},"params":{"object":{"name":"biota.core@0.0.1+IndexesRestoreMany","body":{"query":{"lambda":["ctx","params"],"expr":{"let":[{"biota.core@0.0.1+IndexesRestoreMany":{"let":[{"data":{"object":{}}},{"ref":{"object":{}}},{"namesList":{"select":"namesList","from":{"var":"params"},"default":[]}},{"_inputs":{"object":{"namesList":{"select":"namesList","from":{"var":"params"},"default":[]}}}},{"annotate":{"object":{}}}],"in":{"let":[{"ctx":{"object":{}}},{"ctx":{"object":{"identity":{"select":"identity","from":{"var":"ctx"},"default":null},"session":{"select":"session","from":{"var":"ctx"},"default":null},"callstack":{"if":{"is_string":"biota.core@0.0.1+IndexesRestoreMany"},"then":{"prepend":{"select":"callstack","from":{"var":"ctx"},"default":[]},"collection":["biota.core@0.0.1+IndexesRestoreMany"]},"else":{"select":"callstack","from":{"var":"ctx"},"default":[]}},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"success":{"select":"success","from":{"var":"ctx"},"default":true}}}}],"in":{"let":[{"response":{"map":{"lambda":["name"],"expr":{"select":"response","from":{"call":"biota.core@0.0.1+IndexRestore","arguments":[{"var":"ctx"},{"object":{"name":{"var":"name"}}}]},"default":{"object":{}}}},"collection":{"var":"namesList"}}}],"in":{"object":{"response":{"var":"response"},"success":{"select":"success","from":{"var":"ctx"},"default":true},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"ts":{"now":null}}}}}}}],"in":{"var":"biota.core@0.0.1+IndexesRestoreMany"}}}}}}},"else":{"create_function":{"object":{"name":"biota.core@0.0.1+IndexesRestoreMany","body":{"query":{"lambda":["ctx","params"],"expr":{"let":[{"biota.core@0.0.1+IndexesRestoreMany":{"let":[{"data":{"object":{}}},{"ref":{"object":{}}},{"namesList":{"select":"namesList","from":{"var":"params"},"default":[]}},{"_inputs":{"object":{"namesList":{"select":"namesList","from":{"var":"params"},"default":[]}}}},{"annotate":{"object":{}}}],"in":{"let":[{"ctx":{"object":{}}},{"ctx":{"object":{"identity":{"select":"identity","from":{"var":"ctx"},"default":null},"session":{"select":"session","from":{"var":"ctx"},"default":null},"callstack":{"if":{"is_string":"biota.core@0.0.1+IndexesRestoreMany"},"then":{"prepend":{"select":"callstack","from":{"var":"ctx"},"default":[]},"collection":["biota.core@0.0.1+IndexesRestoreMany"]},"else":{"select":"callstack","from":{"var":"ctx"},"default":[]}},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"success":{"select":"success","from":{"var":"ctx"},"default":true}}}}],"in":{"let":[{"response":{"map":{"lambda":["name"],"expr":{"select":"response","from":{"call":"biota.core@0.0.1+IndexRestore","arguments":[{"var":"ctx"},{"object":{"name":{"var":"name"}}}]},"default":{"object":{}}}},"collection":{"var":"namesList"}}}],"in":{"object":{"response":{"var":"response"},"success":{"select":"success","from":{"var":"ctx"},"default":true},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"ts":{"now":null}}}}}}}],"in":{"var":"biota.core@0.0.1+IndexesRestoreMany"}}}}}}}}}},{"object":{"name":"biota.core@0.0.1+IndexesForgetMany","expression":{"if":{"exists":{"function":"biota.core@0.0.1+IndexesForgetMany"}},"then":{"replace":{"function":"biota.core@0.0.1+IndexesForgetMany"},"params":{"object":{"name":"biota.core@0.0.1+IndexesForgetMany","body":{"query":{"lambda":["ctx","params"],"expr":{"let":[{"biota.core@0.0.1+IndexesForgetMany":{"let":[{"data":{"object":{}}},{"ref":{"object":{}}},{"namesList":{"select":"namesList","from":{"var":"params"},"default":[]}},{"_inputs":{"object":{"namesList":{"select":"namesList","from":{"var":"params"},"default":[]}}}},{"annotate":{"object":{}}}],"in":{"let":[{"ctx":{"object":{}}},{"ctx":{"object":{"identity":{"select":"identity","from":{"var":"ctx"},"default":null},"session":{"select":"session","from":{"var":"ctx"},"default":null},"callstack":{"if":{"is_string":"biota.core@0.0.1+IndexesForgetMany"},"then":{"prepend":{"select":"callstack","from":{"var":"ctx"},"default":[]},"collection":["biota.core@0.0.1+IndexesForgetMany"]},"else":{"select":"callstack","from":{"var":"ctx"},"default":[]}},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"success":{"select":"success","from":{"var":"ctx"},"default":true}}}}],"in":{"let":[{"response":{"map":{"lambda":["name"],"expr":{"select":"response","from":{"call":"biota.core@0.0.1+IndexForget","arguments":[{"var":"ctx"},{"object":{"name":{"var":"name"}}}]},"default":{"object":{}}}},"collection":{"var":"namesList"}}}],"in":{"object":{"response":{"var":"response"},"success":{"select":"success","from":{"var":"ctx"},"default":true},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"ts":{"now":null}}}}}}}],"in":{"var":"biota.core@0.0.1+IndexesForgetMany"}}}}}}},"else":{"create_function":{"object":{"name":"biota.core@0.0.1+IndexesForgetMany","body":{"query":{"lambda":["ctx","params"],"expr":{"let":[{"biota.core@0.0.1+IndexesForgetMany":{"let":[{"data":{"object":{}}},{"ref":{"object":{}}},{"namesList":{"select":"namesList","from":{"var":"params"},"default":[]}},{"_inputs":{"object":{"namesList":{"select":"namesList","from":{"var":"params"},"default":[]}}}},{"annotate":{"object":{}}}],"in":{"let":[{"ctx":{"object":{}}},{"ctx":{"object":{"identity":{"select":"identity","from":{"var":"ctx"},"default":null},"session":{"select":"session","from":{"var":"ctx"},"default":null},"callstack":{"if":{"is_string":"biota.core@0.0.1+IndexesForgetMany"},"then":{"prepend":{"select":"callstack","from":{"var":"ctx"},"default":[]},"collection":["biota.core@0.0.1+IndexesForgetMany"]},"else":{"select":"callstack","from":{"var":"ctx"},"default":[]}},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"success":{"select":"success","from":{"var":"ctx"},"default":true}}}}],"in":{"let":[{"response":{"map":{"lambda":["name"],"expr":{"select":"response","from":{"call":"biota.core@0.0.1+IndexForget","arguments":[{"var":"ctx"},{"object":{"name":{"var":"name"}}}]},"default":{"object":{}}}},"collection":{"var":"namesList"}}}],"in":{"object":{"response":{"var":"response"},"success":{"select":"success","from":{"var":"ctx"},"default":true},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"ts":{"now":null}}}}}}}],"in":{"var":"biota.core@0.0.1+IndexesForgetMany"}}}}}}}}}},{"object":{"name":"biota.core@0.0.1+IndexesDropMany","expression":{"if":{"exists":{"function":"biota.core@0.0.1+IndexesDropMany"}},"then":{"replace":{"function":"biota.core@0.0.1+IndexesDropMany"},"params":{"object":{"name":"biota.core@0.0.1+IndexesDropMany","body":{"query":{"lambda":["ctx","params"],"expr":{"let":[{"biota.core@0.0.1+IndexesDropMany":{"let":[{"data":{"object":{}}},{"ref":{"object":{}}},{"namesList":{"select":"namesList","from":{"var":"params"},"default":[]}},{"_inputs":{"object":{"namesList":{"select":"namesList","from":{"var":"params"},"default":[]}}}},{"annotate":{"object":{}}}],"in":{"let":[{"ctx":{"object":{}}},{"ctx":{"object":{"identity":{"select":"identity","from":{"var":"ctx"},"default":null},"session":{"select":"session","from":{"var":"ctx"},"default":null},"callstack":{"if":{"is_string":"biota.core@0.0.1+IndexesDropMany"},"then":{"prepend":{"select":"callstack","from":{"var":"ctx"},"default":[]},"collection":["biota.core@0.0.1+IndexesDropMany"]},"else":{"select":"callstack","from":{"var":"ctx"},"default":[]}},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"success":{"select":"success","from":{"var":"ctx"},"default":true}}}}],"in":{"let":[{"response":{"map":{"lambda":["name"],"expr":{"select":"response","from":{"call":"biota.core@0.0.1+IndexDrop","arguments":[{"var":"ctx"},{"object":{"name":{"var":"name"}}}]},"default":{"object":{}}}},"collection":{"var":"namesList"}}}],"in":{"object":{"response":{"var":"response"},"success":{"select":"success","from":{"var":"ctx"},"default":true},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"ts":{"now":null}}}}}}}],"in":{"var":"biota.core@0.0.1+IndexesDropMany"}}}}}}},"else":{"create_function":{"object":{"name":"biota.core@0.0.1+IndexesDropMany","body":{"query":{"lambda":["ctx","params"],"expr":{"let":[{"biota.core@0.0.1+IndexesDropMany":{"let":[{"data":{"object":{}}},{"ref":{"object":{}}},{"namesList":{"select":"namesList","from":{"var":"params"},"default":[]}},{"_inputs":{"object":{"namesList":{"select":"namesList","from":{"var":"params"},"default":[]}}}},{"annotate":{"object":{}}}],"in":{"let":[{"ctx":{"object":{}}},{"ctx":{"object":{"identity":{"select":"identity","from":{"var":"ctx"},"default":null},"session":{"select":"session","from":{"var":"ctx"},"default":null},"callstack":{"if":{"is_string":"biota.core@0.0.1+IndexesDropMany"},"then":{"prepend":{"select":"callstack","from":{"var":"ctx"},"default":[]},"collection":["biota.core@0.0.1+IndexesDropMany"]},"else":{"select":"callstack","from":{"var":"ctx"},"default":[]}},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"success":{"select":"success","from":{"var":"ctx"},"default":true}}}}],"in":{"let":[{"response":{"map":{"lambda":["name"],"expr":{"select":"response","from":{"call":"biota.core@0.0.1+IndexDrop","arguments":[{"var":"ctx"},{"object":{"name":{"var":"name"}}}]},"default":{"object":{}}}},"collection":{"var":"namesList"}}}],"in":{"object":{"response":{"var":"response"},"success":{"select":"success","from":{"var":"ctx"},"default":true},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"ts":{"now":null}}}}}}}],"in":{"var":"biota.core@0.0.1+IndexesDropMany"}}}}}}}}}},{"object":{"name":"biota.core@0.0.1+IndexesDropMany","expression":{"if":{"exists":{"function":"biota.core@0.0.1+IndexesDropMany"}},"then":{"replace":{"function":"biota.core@0.0.1+IndexesDropMany"},"params":{"object":{"name":"biota.core@0.0.1+IndexesDropMany","body":{"query":{"lambda":["ctx","params"],"expr":{"let":[{"biota.core@0.0.1+IndexesDropMany":{"let":[{"data":{"object":{}}},{"ref":{"object":{}}},{"namesList":{"select":"namesList","from":{"var":"params"},"default":[]}},{"at":{"select":"at","from":{"var":"params"},"default":null}},{"_inputs":{"object":{"namesList":{"select":"namesList","from":{"var":"params"},"default":[]},"at":{"select":"at","from":{"var":"params"},"default":null}}}},{"annotate":{"object":{}}}],"in":{"let":[{"ctx":{"object":{}}},{"ctx":{"object":{"identity":{"select":"identity","from":{"var":"ctx"},"default":null},"session":{"select":"session","from":{"var":"ctx"},"default":null},"callstack":{"if":{"is_string":"biota.core@0.0.1+IndexesDropMany"},"then":{"prepend":{"select":"callstack","from":{"var":"ctx"},"default":[]},"collection":["biota.core@0.0.1+IndexesDropMany"]},"else":{"select":"callstack","from":{"var":"ctx"},"default":[]}},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"success":{"select":"success","from":{"var":"ctx"},"default":true}}}}],"in":{"let":[{"response":{"map":{"lambda":["name"],"expr":{"select":"response","from":{"call":"biota.core@0.0.1+IndexExpire","arguments":[{"var":"ctx"},{"object":{"name":{"var":"name"},"at":{"var":"at"}}}]},"default":{"object":{}}}},"collection":{"var":"namesList"}}}],"in":{"object":{"response":{"var":"response"},"success":{"select":"success","from":{"var":"ctx"},"default":true},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"ts":{"now":null}}}}}}}],"in":{"var":"biota.core@0.0.1+IndexesDropMany"}}}}}}},"else":{"create_function":{"object":{"name":"biota.core@0.0.1+IndexesDropMany","body":{"query":{"lambda":["ctx","params"],"expr":{"let":[{"biota.core@0.0.1+IndexesDropMany":{"let":[{"data":{"object":{}}},{"ref":{"object":{}}},{"namesList":{"select":"namesList","from":{"var":"params"},"default":[]}},{"at":{"select":"at","from":{"var":"params"},"default":null}},{"_inputs":{"object":{"namesList":{"select":"namesList","from":{"var":"params"},"default":[]},"at":{"select":"at","from":{"var":"params"},"default":null}}}},{"annotate":{"object":{}}}],"in":{"let":[{"ctx":{"object":{}}},{"ctx":{"object":{"identity":{"select":"identity","from":{"var":"ctx"},"default":null},"session":{"select":"session","from":{"var":"ctx"},"default":null},"callstack":{"if":{"is_string":"biota.core@0.0.1+IndexesDropMany"},"then":{"prepend":{"select":"callstack","from":{"var":"ctx"},"default":[]},"collection":["biota.core@0.0.1+IndexesDropMany"]},"else":{"select":"callstack","from":{"var":"ctx"},"default":[]}},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"success":{"select":"success","from":{"var":"ctx"},"default":true}}}}],"in":{"let":[{"response":{"map":{"lambda":["name"],"expr":{"select":"response","from":{"call":"biota.core@0.0.1+IndexExpire","arguments":[{"var":"ctx"},{"object":{"name":{"var":"name"},"at":{"var":"at"}}}]},"default":{"object":{}}}},"collection":{"var":"namesList"}}}],"in":{"object":{"response":{"var":"response"},"success":{"select":"success","from":{"var":"ctx"},"default":true},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"ts":{"now":null}}}}}}}],"in":{"var":"biota.core@0.0.1+IndexesDropMany"}}}}}}}}}},{"object":{"name":"biota.core@0.0.1+IndexesDropMany","expression":{"if":{"exists":{"function":"biota.core@0.0.1+IndexesDropMany"}},"then":{"replace":{"function":"biota.core@0.0.1+IndexesDropMany"},"params":{"object":{"name":"biota.core@0.0.1+IndexesDropMany","body":{"query":{"lambda":["ctx","params"],"expr":{"let":[{"biota.core@0.0.1+IndexesDropMany":{"let":[{"data":{"object":{}}},{"ref":{"object":{}}},{"namesList":{"select":"namesList","from":{"var":"params"},"default":[]}},{"delay":{"select":"delay","from":{"var":"params"},"default":null}},{"_inputs":{"object":{"namesList":{"select":"namesList","from":{"var":"params"},"default":[]},"delay":{"select":"delay","from":{"var":"params"},"default":null}}}},{"annotate":{"object":{}}}],"in":{"let":[{"ctx":{"object":{}}},{"ctx":{"object":{"identity":{"select":"identity","from":{"var":"ctx"},"default":null},"session":{"select":"session","from":{"var":"ctx"},"default":null},"callstack":{"if":{"is_string":"biota.core@0.0.1+IndexesDropMany"},"then":{"prepend":{"select":"callstack","from":{"var":"ctx"},"default":[]},"collection":["biota.core@0.0.1+IndexesDropMany"]},"else":{"select":"callstack","from":{"var":"ctx"},"default":[]}},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"success":{"select":"success","from":{"var":"ctx"},"default":true}}}}],"in":{"let":[{"response":{"map":{"lambda":["name"],"expr":{"select":"response","from":{"call":"biota.core@0.0.1+IndexExpireIn","arguments":[{"var":"ctx"},{"object":{"name":{"var":"name"},"delay":{"var":"delay"}}}]},"default":{"object":{}}}},"collection":{"var":"namesList"}}}],"in":{"object":{"response":{"var":"response"},"success":{"select":"success","from":{"var":"ctx"},"default":true},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"ts":{"now":null}}}}}}}],"in":{"var":"biota.core@0.0.1+IndexesDropMany"}}}}}}},"else":{"create_function":{"object":{"name":"biota.core@0.0.1+IndexesDropMany","body":{"query":{"lambda":["ctx","params"],"expr":{"let":[{"biota.core@0.0.1+IndexesDropMany":{"let":[{"data":{"object":{}}},{"ref":{"object":{}}},{"namesList":{"select":"namesList","from":{"var":"params"},"default":[]}},{"delay":{"select":"delay","from":{"var":"params"},"default":null}},{"_inputs":{"object":{"namesList":{"select":"namesList","from":{"var":"params"},"default":[]},"delay":{"select":"delay","from":{"var":"params"},"default":null}}}},{"annotate":{"object":{}}}],"in":{"let":[{"ctx":{"object":{}}},{"ctx":{"object":{"identity":{"select":"identity","from":{"var":"ctx"},"default":null},"session":{"select":"session","from":{"var":"ctx"},"default":null},"callstack":{"if":{"is_string":"biota.core@0.0.1+IndexesDropMany"},"then":{"prepend":{"select":"callstack","from":{"var":"ctx"},"default":[]},"collection":["biota.core@0.0.1+IndexesDropMany"]},"else":{"select":"callstack","from":{"var":"ctx"},"default":[]}},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"success":{"select":"success","from":{"var":"ctx"},"default":true}}}}],"in":{"let":[{"response":{"map":{"lambda":["name"],"expr":{"select":"response","from":{"call":"biota.core@0.0.1+IndexExpireIn","arguments":[{"var":"ctx"},{"object":{"name":{"var":"name"},"delay":{"var":"delay"}}}]},"default":{"object":{}}}},"collection":{"var":"namesList"}}}],"in":{"object":{"response":{"var":"response"},"success":{"select":"success","from":{"var":"ctx"},"default":true},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"ts":{"now":null}}}}}}}],"in":{"var":"biota.core@0.0.1+IndexesDropMany"}}}}}}}}}},{"object":{"name":"biota.core@0.0.1+IndexesDropMany","expression":{"if":{"exists":{"function":"biota.core@0.0.1+IndexesDropMany"}},"then":{"replace":{"function":"biota.core@0.0.1+IndexesDropMany"},"params":{"object":{"name":"biota.core@0.0.1+IndexesDropMany","body":{"query":{"lambda":["ctx","params"],"expr":{"let":[{"biota.core@0.0.1+IndexesDropMany":{"let":[{"data":{"object":{}}},{"ref":{"object":{}}},{"namesList":{"select":"namesList","from":{"var":"params"},"default":[]}},{"_inputs":{"object":{"namesList":{"select":"namesList","from":{"var":"params"},"default":[]}}}},{"annotate":{"object":{}}}],"in":{"let":[{"ctx":{"object":{}}},{"ctx":{"object":{"identity":{"select":"identity","from":{"var":"ctx"},"default":null},"session":{"select":"session","from":{"var":"ctx"},"default":null},"callstack":{"if":{"is_string":"biota.core@0.0.1+IndexesDropMany"},"then":{"prepend":{"select":"callstack","from":{"var":"ctx"},"default":[]},"collection":["biota.core@0.0.1+IndexesDropMany"]},"else":{"select":"callstack","from":{"var":"ctx"},"default":[]}},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"success":{"select":"success","from":{"var":"ctx"},"default":true}}}}],"in":{"let":[{"response":{"map":{"lambda":["name"],"expr":{"select":"response","from":{"call":"biota.core@0.0.1+IndexExpireNow","arguments":[{"var":"ctx"},{"object":{"name":{"var":"name"}}}]},"default":{"object":{}}}},"collection":{"var":"namesList"}}}],"in":{"object":{"response":{"var":"response"},"success":{"select":"success","from":{"var":"ctx"},"default":true},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"ts":{"now":null}}}}}}}],"in":{"var":"biota.core@0.0.1+IndexesDropMany"}}}}}}},"else":{"create_function":{"object":{"name":"biota.core@0.0.1+IndexesDropMany","body":{"query":{"lambda":["ctx","params"],"expr":{"let":[{"biota.core@0.0.1+IndexesDropMany":{"let":[{"data":{"object":{}}},{"ref":{"object":{}}},{"namesList":{"select":"namesList","from":{"var":"params"},"default":[]}},{"_inputs":{"object":{"namesList":{"select":"namesList","from":{"var":"params"},"default":[]}}}},{"annotate":{"object":{}}}],"in":{"let":[{"ctx":{"object":{}}},{"ctx":{"object":{"identity":{"select":"identity","from":{"var":"ctx"},"default":null},"session":{"select":"session","from":{"var":"ctx"},"default":null},"callstack":{"if":{"is_string":"biota.core@0.0.1+IndexesDropMany"},"then":{"prepend":{"select":"callstack","from":{"var":"ctx"},"default":[]},"collection":["biota.core@0.0.1+IndexesDropMany"]},"else":{"select":"callstack","from":{"var":"ctx"},"default":[]}},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"success":{"select":"success","from":{"var":"ctx"},"default":true}}}}],"in":{"let":[{"response":{"map":{"lambda":["name"],"expr":{"select":"response","from":{"call":"biota.core@0.0.1+IndexExpireNow","arguments":[{"var":"ctx"},{"object":{"name":{"var":"name"}}}]},"default":{"object":{}}}},"collection":{"var":"namesList"}}}],"in":{"object":{"response":{"var":"response"},"success":{"select":"success","from":{"var":"ctx"},"default":true},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"ts":{"now":null}}}}}}}],"in":{"var":"biota.core@0.0.1+IndexesDropMany"}}}}}}}}}},{"object":{"name":"biota.core@0.0.1+KeyGet","expression":{"if":{"exists":{"function":"biota.core@0.0.1+KeyGet"}},"then":{"replace":{"function":"biota.core@0.0.1+KeyGet"},"params":{"object":{"name":"biota.core@0.0.1+KeyGet","body":{"query":{"lambda":["ctx","params"],"expr":{"let":[{"biota.core@0.0.1+KeyGet":{"let":[{"data":{"object":{}}},{"ref":{"object":{}}},{"id":{"select":"id","from":{"var":"params"},"default":null}},{"_inputs":{"object":{"id":{"select":"id","from":{"var":"params"},"default":null}}}},{"annotate":{"object":{}}}],"in":{"let":[{"ctx":{"object":{}}},{"ctx":{"object":{"identity":{"select":"identity","from":{"var":"ctx"},"default":null},"session":{"select":"session","from":{"var":"ctx"},"default":null},"callstack":{"if":{"is_string":"biota.core@0.0.1+KeyGet"},"then":{"prepend":{"select":"callstack","from":{"var":"ctx"},"default":[]},"collection":["biota.core@0.0.1+KeyGet"]},"else":{"select":"callstack","from":{"var":"ctx"},"default":[]}},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"success":{"select":"success","from":{"var":"ctx"},"default":true}}}}],"in":{"let":[{"ref":{"ref":{"keys":null},"id":{"var":"id"}}},{"valid":{"select":"response","from":{"call":"biota.schema@0.0.1+ValidateThrow","arguments":[{"var":"ctx"},{"object":{"code":"instance_not_found","value":{"var":"ref"},"options":{"object":{"type":"key"}},"state":{"object":{}}}}]},"default":{"object":{}}}}],"in":{"let":[{"response":{"get":{"ref":{"keys":null},"id":{"var":"id"}}}}],"in":{"object":{"response":{"var":"response"},"success":{"select":"success","from":{"var":"ctx"},"default":true},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"ts":{"now":null}}}}}}}}],"in":{"var":"biota.core@0.0.1+KeyGet"}}}}}}},"else":{"create_function":{"object":{"name":"biota.core@0.0.1+KeyGet","body":{"query":{"lambda":["ctx","params"],"expr":{"let":[{"biota.core@0.0.1+KeyGet":{"let":[{"data":{"object":{}}},{"ref":{"object":{}}},{"id":{"select":"id","from":{"var":"params"},"default":null}},{"_inputs":{"object":{"id":{"select":"id","from":{"var":"params"},"default":null}}}},{"annotate":{"object":{}}}],"in":{"let":[{"ctx":{"object":{}}},{"ctx":{"object":{"identity":{"select":"identity","from":{"var":"ctx"},"default":null},"session":{"select":"session","from":{"var":"ctx"},"default":null},"callstack":{"if":{"is_string":"biota.core@0.0.1+KeyGet"},"then":{"prepend":{"select":"callstack","from":{"var":"ctx"},"default":[]},"collection":["biota.core@0.0.1+KeyGet"]},"else":{"select":"callstack","from":{"var":"ctx"},"default":[]}},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"success":{"select":"success","from":{"var":"ctx"},"default":true}}}}],"in":{"let":[{"ref":{"ref":{"keys":null},"id":{"var":"id"}}},{"valid":{"select":"response","from":{"call":"biota.schema@0.0.1+ValidateThrow","arguments":[{"var":"ctx"},{"object":{"code":"instance_not_found","value":{"var":"ref"},"options":{"object":{"type":"key"}},"state":{"object":{}}}}]},"default":{"object":{}}}}],"in":{"let":[{"response":{"get":{"ref":{"keys":null},"id":{"var":"id"}}}}],"in":{"object":{"response":{"var":"response"},"success":{"select":"success","from":{"var":"ctx"},"default":true},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"ts":{"now":null}}}}}}}}],"in":{"var":"biota.core@0.0.1+KeyGet"}}}}}}}}}},{"object":{"name":"biota.core@0.0.1+KeyInsert","expression":{"if":{"exists":{"function":"biota.core@0.0.1+KeyInsert"}},"then":{"replace":{"function":"biota.core@0.0.1+KeyInsert"},"params":{"object":{"name":"biota.core@0.0.1+KeyInsert","body":{"query":{"lambda":["ctx","params"],"expr":{"let":[{"biota.core@0.0.1+KeyInsert":{"let":[{"data":{"object":{}}},{"ref":{"object":{}}},{"options":{"select":"options","from":{"var":"params"},"default":null}},{"_inputs":{"object":{"options":{"select":"options","from":{"var":"params"},"default":null}}}},{"annotate":{"object":{}}}],"in":{"let":[{"ctx":{"object":{}}},{"ctx":{"object":{"identity":{"select":"identity","from":{"var":"ctx"},"default":null},"session":{"select":"session","from":{"var":"ctx"},"default":null},"callstack":{"if":{"is_string":"biota.core@0.0.1+KeyInsert"},"then":{"prepend":{"select":"callstack","from":{"var":"ctx"},"default":[]},"collection":["biota.core@0.0.1+KeyInsert"]},"else":{"select":"callstack","from":{"var":"ctx"},"default":[]}},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"success":{"select":"success","from":{"var":"ctx"},"default":true}}}}],"in":{"let":[{"data":{"select":"data","from":{"var":"options"},"default":{"object":{}}}},{"schema":{"select":"response","from":{"call":"biota.schema@0.0.1+ValidateThrow","arguments":[{"var":"ctx"},{"object":{"code":"data_validation_failed","value":{"var":"options"},"options":{"object":{"type":"schema","schema":"biota.schema@0.0.1+Key.schema","options":{"object":{}}}},"state":{"object":{}}}}]},"default":{"object":{}}}}],"in":{"let":[{"annotationName":"insert"},{"annotationData":{"var":"data"}},{"annotationInputs":{"var":"annotate"}},{"data":{"select":"response","from":{"call":"biota.builder@0.0.1+Annotate","arguments":[{"var":"ctx"},{"object":{"action":{"var":"annotationName"},"data":{"var":"annotationData"},"input":{"var":"annotationInputs"}}}]},"default":{"object":{}}}}],"in":{"let":[{"response":{"create_key":{"merge":{"var":"options"},"with":{"object":{"data":{"var":"data"}}}}}}],"in":{"let":[{"actionName":"insert"},{"actionRef":{"select":"ref","from":{"var":"response"},"default":null}},{"data":{"if":{"not":{"is_null":{"var":"actionRef"}}},"then":{"select":"response","from":{"call":"biota.builder@0.0.1+ActionLog","arguments":[{"var":"ctx"},{"object":{"name":{"var":"actionName"},"instance":{"var":"actionRef"}}}]},"default":{"object":{}}},"else":""}}],"in":{"object":{"response":{"var":"response"},"success":{"select":"success","from":{"var":"ctx"},"default":true},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"ts":{"now":null}}}}}}}}}}],"in":{"var":"biota.core@0.0.1+KeyInsert"}}}}}}},"else":{"create_function":{"object":{"name":"biota.core@0.0.1+KeyInsert","body":{"query":{"lambda":["ctx","params"],"expr":{"let":[{"biota.core@0.0.1+KeyInsert":{"let":[{"data":{"object":{}}},{"ref":{"object":{}}},{"options":{"select":"options","from":{"var":"params"},"default":null}},{"_inputs":{"object":{"options":{"select":"options","from":{"var":"params"},"default":null}}}},{"annotate":{"object":{}}}],"in":{"let":[{"ctx":{"object":{}}},{"ctx":{"object":{"identity":{"select":"identity","from":{"var":"ctx"},"default":null},"session":{"select":"session","from":{"var":"ctx"},"default":null},"callstack":{"if":{"is_string":"biota.core@0.0.1+KeyInsert"},"then":{"prepend":{"select":"callstack","from":{"var":"ctx"},"default":[]},"collection":["biota.core@0.0.1+KeyInsert"]},"else":{"select":"callstack","from":{"var":"ctx"},"default":[]}},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"success":{"select":"success","from":{"var":"ctx"},"default":true}}}}],"in":{"let":[{"data":{"select":"data","from":{"var":"options"},"default":{"object":{}}}},{"schema":{"select":"response","from":{"call":"biota.schema@0.0.1+ValidateThrow","arguments":[{"var":"ctx"},{"object":{"code":"data_validation_failed","value":{"var":"options"},"options":{"object":{"type":"schema","schema":"biota.schema@0.0.1+Key.schema","options":{"object":{}}}},"state":{"object":{}}}}]},"default":{"object":{}}}}],"in":{"let":[{"annotationName":"insert"},{"annotationData":{"var":"data"}},{"annotationInputs":{"var":"annotate"}},{"data":{"select":"response","from":{"call":"biota.builder@0.0.1+Annotate","arguments":[{"var":"ctx"},{"object":{"action":{"var":"annotationName"},"data":{"var":"annotationData"},"input":{"var":"annotationInputs"}}}]},"default":{"object":{}}}}],"in":{"let":[{"response":{"create_key":{"merge":{"var":"options"},"with":{"object":{"data":{"var":"data"}}}}}}],"in":{"let":[{"actionName":"insert"},{"actionRef":{"select":"ref","from":{"var":"response"},"default":null}},{"data":{"if":{"not":{"is_null":{"var":"actionRef"}}},"then":{"select":"response","from":{"call":"biota.builder@0.0.1+ActionLog","arguments":[{"var":"ctx"},{"object":{"name":{"var":"actionName"},"instance":{"var":"actionRef"}}}]},"default":{"object":{}}},"else":""}}],"in":{"object":{"response":{"var":"response"},"success":{"select":"success","from":{"var":"ctx"},"default":true},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"ts":{"now":null}}}}}}}}}}],"in":{"var":"biota.core@0.0.1+KeyInsert"}}}}}}}}}},{"object":{"name":"biota.core@0.0.1+KeyUpdate","expression":{"if":{"exists":{"function":"biota.core@0.0.1+KeyUpdate"}},"then":{"replace":{"function":"biota.core@0.0.1+KeyUpdate"},"params":{"object":{"name":"biota.core@0.0.1+KeyUpdate","body":{"query":{"lambda":["ctx","params"],"expr":{"let":[{"biota.core@0.0.1+KeyUpdate":{"let":[{"data":{"object":{}}},{"ref":{"object":{}}},{"id":{"select":"id","from":{"var":"params"},"default":null}},{"options":{"select":"options","from":{"var":"params"},"default":{"object":{}}}},{"_inputs":{"object":{"id":{"select":"id","from":{"var":"params"},"default":null},"options":{"select":"options","from":{"var":"params"},"default":{"object":{}}}}}},{"annotate":{"object":{}}}],"in":{"let":[{"ctx":{"object":{}}},{"ctx":{"object":{"identity":{"select":"identity","from":{"var":"ctx"},"default":null},"session":{"select":"session","from":{"var":"ctx"},"default":null},"callstack":{"if":{"is_string":"biota.core@0.0.1+KeyUpdate"},"then":{"prepend":{"select":"callstack","from":{"var":"ctx"},"default":[]},"collection":["biota.core@0.0.1+KeyUpdate"]},"else":{"select":"callstack","from":{"var":"ctx"},"default":[]}},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"success":{"select":"success","from":{"var":"ctx"},"default":true}}}}],"in":{"let":[{"data":{"select":"data","from":{"var":"id"},"default":{"object":{}}}},{"schema":{"select":"response","from":{"call":"biota.schema@0.0.1+ValidateThrow","arguments":[{"var":"ctx"},{"object":{"code":"data_validation_failed","value":{"var":"id"},"options":{"object":{"type":"schema","schema":"biota.schema@0.0.1+Key.schema","options":{"object":{"optionals":"*"}}}},"state":{"object":{}}}}]},"default":{"object":{}}}}],"in":{"let":[{"annotationName":"update"},{"annotationData":{"var":"data"}},{"annotationInputs":{"var":"annotate"}},{"data":{"select":"response","from":{"call":"biota.builder@0.0.1+Annotate","arguments":[{"var":"ctx"},{"object":{"action":{"var":"annotationName"},"data":{"var":"annotationData"},"input":{"var":"annotationInputs"}}}]},"default":{"object":{}}}}],"in":{"let":[{"response":{"update":{"ref":{"keys":null},"id":{"var":"id"}},"params":{"merge":{"var":"options"},"with":{"object":{"data":{"var":"data"}}}}}}],"in":{"let":[{"actionName":"update"},{"actionRef":{"select":"ref","from":{"var":"response"},"default":null}},{"data":{"if":{"not":{"is_null":{"var":"actionRef"}}},"then":{"select":"response","from":{"call":"biota.builder@0.0.1+ActionLog","arguments":[{"var":"ctx"},{"object":{"name":{"var":"actionName"},"instance":{"var":"actionRef"}}}]},"default":{"object":{}}},"else":""}}],"in":{"object":{"response":{"var":"response"},"success":{"select":"success","from":{"var":"ctx"},"default":true},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"ts":{"now":null}}}}}}}}}}],"in":{"var":"biota.core@0.0.1+KeyUpdate"}}}}}}},"else":{"create_function":{"object":{"name":"biota.core@0.0.1+KeyUpdate","body":{"query":{"lambda":["ctx","params"],"expr":{"let":[{"biota.core@0.0.1+KeyUpdate":{"let":[{"data":{"object":{}}},{"ref":{"object":{}}},{"id":{"select":"id","from":{"var":"params"},"default":null}},{"options":{"select":"options","from":{"var":"params"},"default":{"object":{}}}},{"_inputs":{"object":{"id":{"select":"id","from":{"var":"params"},"default":null},"options":{"select":"options","from":{"var":"params"},"default":{"object":{}}}}}},{"annotate":{"object":{}}}],"in":{"let":[{"ctx":{"object":{}}},{"ctx":{"object":{"identity":{"select":"identity","from":{"var":"ctx"},"default":null},"session":{"select":"session","from":{"var":"ctx"},"default":null},"callstack":{"if":{"is_string":"biota.core@0.0.1+KeyUpdate"},"then":{"prepend":{"select":"callstack","from":{"var":"ctx"},"default":[]},"collection":["biota.core@0.0.1+KeyUpdate"]},"else":{"select":"callstack","from":{"var":"ctx"},"default":[]}},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"success":{"select":"success","from":{"var":"ctx"},"default":true}}}}],"in":{"let":[{"data":{"select":"data","from":{"var":"id"},"default":{"object":{}}}},{"schema":{"select":"response","from":{"call":"biota.schema@0.0.1+ValidateThrow","arguments":[{"var":"ctx"},{"object":{"code":"data_validation_failed","value":{"var":"id"},"options":{"object":{"type":"schema","schema":"biota.schema@0.0.1+Key.schema","options":{"object":{"optionals":"*"}}}},"state":{"object":{}}}}]},"default":{"object":{}}}}],"in":{"let":[{"annotationName":"update"},{"annotationData":{"var":"data"}},{"annotationInputs":{"var":"annotate"}},{"data":{"select":"response","from":{"call":"biota.builder@0.0.1+Annotate","arguments":[{"var":"ctx"},{"object":{"action":{"var":"annotationName"},"data":{"var":"annotationData"},"input":{"var":"annotationInputs"}}}]},"default":{"object":{}}}}],"in":{"let":[{"response":{"update":{"ref":{"keys":null},"id":{"var":"id"}},"params":{"merge":{"var":"options"},"with":{"object":{"data":{"var":"data"}}}}}}],"in":{"let":[{"actionName":"update"},{"actionRef":{"select":"ref","from":{"var":"response"},"default":null}},{"data":{"if":{"not":{"is_null":{"var":"actionRef"}}},"then":{"select":"response","from":{"call":"biota.builder@0.0.1+ActionLog","arguments":[{"var":"ctx"},{"object":{"name":{"var":"actionName"},"instance":{"var":"actionRef"}}}]},"default":{"object":{}}},"else":""}}],"in":{"object":{"response":{"var":"response"},"success":{"select":"success","from":{"var":"ctx"},"default":true},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"ts":{"now":null}}}}}}}}}}],"in":{"var":"biota.core@0.0.1+KeyUpdate"}}}}}}}}}},{"object":{"name":"biota.core@0.0.1+KeyUpsert","expression":{"if":{"exists":{"function":"biota.core@0.0.1+KeyUpsert"}},"then":{"replace":{"function":"biota.core@0.0.1+KeyUpsert"},"params":{"object":{"name":"biota.core@0.0.1+KeyUpsert","body":{"query":{"lambda":["ctx","params"],"expr":{"let":[{"biota.core@0.0.1+KeyUpsert":{"let":[{"data":{"object":{}}},{"ref":{"object":{}}},{"id":{"select":"id","from":{"var":"params"},"default":null}},{"options":{"select":"options","from":{"var":"params"},"default":{"object":{}}}},{"_inputs":{"object":{"id":{"select":"id","from":{"var":"params"},"default":null},"options":{"select":"options","from":{"var":"params"},"default":{"object":{}}}}}},{"annotate":{"object":{}}}],"in":{"let":[{"ctx":{"object":{}}},{"ctx":{"object":{"identity":{"select":"identity","from":{"var":"ctx"},"default":null},"session":{"select":"session","from":{"var":"ctx"},"default":null},"callstack":{"if":{"is_string":"biota.core@0.0.1+KeyUpsert"},"then":{"prepend":{"select":"callstack","from":{"var":"ctx"},"default":[]},"collection":["biota.core@0.0.1+KeyUpsert"]},"else":{"select":"callstack","from":{"var":"ctx"},"default":[]}},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"success":{"select":"success","from":{"var":"ctx"},"default":true}}}}],"in":{"let":[{"data":{"select":"data","from":{"var":"id"},"default":{"object":{}}}},{"schema":{"select":"response","from":{"call":"biota.schema@0.0.1+ValidateThrow","arguments":[{"var":"ctx"},{"object":{"code":"data_validation_failed","value":{"var":"id"},"options":{"object":{"type":"schema","schema":"biota.schema@0.0.1+Key.schema","options":{"object":{"optionals":"*"}}}},"state":{"object":{}}}}]},"default":{"object":{}}}}],"in":{"let":[{"response":{"if":{"select":"valid","from":{"select":"response","from":{"call":"biota.schema@0.0.1+Validate","arguments":[{"var":"ctx"},{"object":{"value":{"ref":{"keys":null},"id":{"var":"id"}},"options":{"object":{"type":"key"}},"state":{"object":{}}}}]},"default":{"object":{}}},"default":false},"then":{"select":"response","from":{"call":"biota.core@0.0.1+KeyUpdate","arguments":[{"var":"ctx"},{"object":{"id":{"var":"id"},"options":{"var":"options"}}}]},"default":{"object":{}}},"else":{"select":"response","from":{"call":"biota.core@0.0.1+KeyInsert","arguments":[{"var":"ctx"},{"object":{"options":{"var":"options"}}}]},"default":{"object":{}}}}}],"in":{"object":{"response":{"var":"response"},"success":{"select":"success","from":{"var":"ctx"},"default":true},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"ts":{"now":null}}}}}}}}],"in":{"var":"biota.core@0.0.1+KeyUpsert"}}}}}}},"else":{"create_function":{"object":{"name":"biota.core@0.0.1+KeyUpsert","body":{"query":{"lambda":["ctx","params"],"expr":{"let":[{"biota.core@0.0.1+KeyUpsert":{"let":[{"data":{"object":{}}},{"ref":{"object":{}}},{"id":{"select":"id","from":{"var":"params"},"default":null}},{"options":{"select":"options","from":{"var":"params"},"default":{"object":{}}}},{"_inputs":{"object":{"id":{"select":"id","from":{"var":"params"},"default":null},"options":{"select":"options","from":{"var":"params"},"default":{"object":{}}}}}},{"annotate":{"object":{}}}],"in":{"let":[{"ctx":{"object":{}}},{"ctx":{"object":{"identity":{"select":"identity","from":{"var":"ctx"},"default":null},"session":{"select":"session","from":{"var":"ctx"},"default":null},"callstack":{"if":{"is_string":"biota.core@0.0.1+KeyUpsert"},"then":{"prepend":{"select":"callstack","from":{"var":"ctx"},"default":[]},"collection":["biota.core@0.0.1+KeyUpsert"]},"else":{"select":"callstack","from":{"var":"ctx"},"default":[]}},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"success":{"select":"success","from":{"var":"ctx"},"default":true}}}}],"in":{"let":[{"data":{"select":"data","from":{"var":"id"},"default":{"object":{}}}},{"schema":{"select":"response","from":{"call":"biota.schema@0.0.1+ValidateThrow","arguments":[{"var":"ctx"},{"object":{"code":"data_validation_failed","value":{"var":"id"},"options":{"object":{"type":"schema","schema":"biota.schema@0.0.1+Key.schema","options":{"object":{"optionals":"*"}}}},"state":{"object":{}}}}]},"default":{"object":{}}}}],"in":{"let":[{"response":{"if":{"select":"valid","from":{"select":"response","from":{"call":"biota.schema@0.0.1+Validate","arguments":[{"var":"ctx"},{"object":{"value":{"ref":{"keys":null},"id":{"var":"id"}},"options":{"object":{"type":"key"}},"state":{"object":{}}}}]},"default":{"object":{}}},"default":false},"then":{"select":"response","from":{"call":"biota.core@0.0.1+KeyUpdate","arguments":[{"var":"ctx"},{"object":{"id":{"var":"id"},"options":{"var":"options"}}}]},"default":{"object":{}}},"else":{"select":"response","from":{"call":"biota.core@0.0.1+KeyInsert","arguments":[{"var":"ctx"},{"object":{"options":{"var":"options"}}}]},"default":{"object":{}}}}}],"in":{"object":{"response":{"var":"response"},"success":{"select":"success","from":{"var":"ctx"},"default":true},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"ts":{"now":null}}}}}}}}],"in":{"var":"biota.core@0.0.1+KeyUpsert"}}}}}}}}}},{"object":{"name":"biota.core@0.0.1+KeyReplace","expression":{"if":{"exists":{"function":"biota.core@0.0.1+KeyReplace"}},"then":{"replace":{"function":"biota.core@0.0.1+KeyReplace"},"params":{"object":{"name":"biota.core@0.0.1+KeyReplace","body":{"query":{"lambda":["ctx","params"],"expr":{"let":[{"biota.core@0.0.1+KeyReplace":{"let":[{"data":{"object":{}}},{"ref":{"object":{}}},{"id":{"select":"id","from":{"var":"params"},"default":null}},{"options":{"select":"options","from":{"var":"params"},"default":{"object":{}}}},{"_inputs":{"object":{"id":{"select":"id","from":{"var":"params"},"default":null},"options":{"select":"options","from":{"var":"params"},"default":{"object":{}}}}}},{"annotate":{"object":{}}}],"in":{"let":[{"ctx":{"object":{}}},{"ctx":{"object":{"identity":{"select":"identity","from":{"var":"ctx"},"default":null},"session":{"select":"session","from":{"var":"ctx"},"default":null},"callstack":{"if":{"is_string":"biota.core@0.0.1+KeyReplace"},"then":{"prepend":{"select":"callstack","from":{"var":"ctx"},"default":[]},"collection":["biota.core@0.0.1+KeyReplace"]},"else":{"select":"callstack","from":{"var":"ctx"},"default":[]}},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"success":{"select":"success","from":{"var":"ctx"},"default":true}}}}],"in":{"let":[{"ref":{"ref":{"keys":null},"id":{"var":"id"}}},{"valid":{"select":"response","from":{"call":"biota.schema@0.0.1+ValidateThrow","arguments":[{"var":"ctx"},{"object":{"code":"instance_not_found","value":{"var":"ref"},"options":{"object":{"type":"key"}},"state":{"object":{}}}}]},"default":{"object":{}}}},{"doc":{"select":"response","from":{"call":"biota.core@0.0.1+KeyGet","arguments":[{"var":"ctx"},{"object":{"id":{"var":"id"}}}]},"default":{"object":{}}}},{"data":{"select":"data","from":{"var":"doc"},"default":{"object":{}}}}],"in":{"let":[{"annotationName":"replace"},{"annotationData":{"var":"data"}},{"annotationInputs":{"var":"annotate"}},{"data":{"select":"response","from":{"call":"biota.builder@0.0.1+Annotate","arguments":[{"var":"ctx"},{"object":{"action":{"var":"annotationName"},"data":{"var":"annotationData"},"input":{"var":"annotationInputs"}}}]},"default":{"object":{}}}}],"in":{"let":[{"response":{"replace":{"ref":{"keys":null},"id":{"var":"id"}},"params":{"merge":{"var":"options"},"with":{"object":{"data":{"var":"data"}}}}}}],"in":{"let":[{"actionName":"replace"},{"actionRef":{"select":"ref","from":{"var":"response"},"default":null}},{"data":{"if":{"not":{"is_null":{"var":"actionRef"}}},"then":{"select":"response","from":{"call":"biota.builder@0.0.1+ActionLog","arguments":[{"var":"ctx"},{"object":{"name":{"var":"actionName"},"instance":{"var":"actionRef"}}}]},"default":{"object":{}}},"else":""}}],"in":{"object":{"response":{"var":"response"},"success":{"select":"success","from":{"var":"ctx"},"default":true},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"ts":{"now":null}}}}}}}}}}],"in":{"var":"biota.core@0.0.1+KeyReplace"}}}}}}},"else":{"create_function":{"object":{"name":"biota.core@0.0.1+KeyReplace","body":{"query":{"lambda":["ctx","params"],"expr":{"let":[{"biota.core@0.0.1+KeyReplace":{"let":[{"data":{"object":{}}},{"ref":{"object":{}}},{"id":{"select":"id","from":{"var":"params"},"default":null}},{"options":{"select":"options","from":{"var":"params"},"default":{"object":{}}}},{"_inputs":{"object":{"id":{"select":"id","from":{"var":"params"},"default":null},"options":{"select":"options","from":{"var":"params"},"default":{"object":{}}}}}},{"annotate":{"object":{}}}],"in":{"let":[{"ctx":{"object":{}}},{"ctx":{"object":{"identity":{"select":"identity","from":{"var":"ctx"},"default":null},"session":{"select":"session","from":{"var":"ctx"},"default":null},"callstack":{"if":{"is_string":"biota.core@0.0.1+KeyReplace"},"then":{"prepend":{"select":"callstack","from":{"var":"ctx"},"default":[]},"collection":["biota.core@0.0.1+KeyReplace"]},"else":{"select":"callstack","from":{"var":"ctx"},"default":[]}},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"success":{"select":"success","from":{"var":"ctx"},"default":true}}}}],"in":{"let":[{"ref":{"ref":{"keys":null},"id":{"var":"id"}}},{"valid":{"select":"response","from":{"call":"biota.schema@0.0.1+ValidateThrow","arguments":[{"var":"ctx"},{"object":{"code":"instance_not_found","value":{"var":"ref"},"options":{"object":{"type":"key"}},"state":{"object":{}}}}]},"default":{"object":{}}}},{"doc":{"select":"response","from":{"call":"biota.core@0.0.1+KeyGet","arguments":[{"var":"ctx"},{"object":{"id":{"var":"id"}}}]},"default":{"object":{}}}},{"data":{"select":"data","from":{"var":"doc"},"default":{"object":{}}}}],"in":{"let":[{"annotationName":"replace"},{"annotationData":{"var":"data"}},{"annotationInputs":{"var":"annotate"}},{"data":{"select":"response","from":{"call":"biota.builder@0.0.1+Annotate","arguments":[{"var":"ctx"},{"object":{"action":{"var":"annotationName"},"data":{"var":"annotationData"},"input":{"var":"annotationInputs"}}}]},"default":{"object":{}}}}],"in":{"let":[{"response":{"replace":{"ref":{"keys":null},"id":{"var":"id"}},"params":{"merge":{"var":"options"},"with":{"object":{"data":{"var":"data"}}}}}}],"in":{"let":[{"actionName":"replace"},{"actionRef":{"select":"ref","from":{"var":"response"},"default":null}},{"data":{"if":{"not":{"is_null":{"var":"actionRef"}}},"then":{"select":"response","from":{"call":"biota.builder@0.0.1+ActionLog","arguments":[{"var":"ctx"},{"object":{"name":{"var":"actionName"},"instance":{"var":"actionRef"}}}]},"default":{"object":{}}},"else":""}}],"in":{"object":{"response":{"var":"response"},"success":{"select":"success","from":{"var":"ctx"},"default":true},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"ts":{"now":null}}}}}}}}}}],"in":{"var":"biota.core@0.0.1+KeyReplace"}}}}}}}}}},{"object":{"name":"biota.core@0.0.1+KeyRepsert","expression":{"if":{"exists":{"function":"biota.core@0.0.1+KeyRepsert"}},"then":{"replace":{"function":"biota.core@0.0.1+KeyRepsert"},"params":{"object":{"name":"biota.core@0.0.1+KeyRepsert","body":{"query":{"lambda":["ctx","params"],"expr":{"let":[{"biota.core@0.0.1+KeyRepsert":{"let":[{"data":{"object":{}}},{"ref":{"object":{}}},{"id":{"select":"id","from":{"var":"params"},"default":null}},{"options":{"select":"options","from":{"var":"params"},"default":{"object":{}}}},{"_inputs":{"object":{"id":{"select":"id","from":{"var":"params"},"default":null},"options":{"select":"options","from":{"var":"params"},"default":{"object":{}}}}}},{"annotate":{"object":{}}}],"in":{"let":[{"ctx":{"object":{}}},{"ctx":{"object":{"identity":{"select":"identity","from":{"var":"ctx"},"default":null},"session":{"select":"session","from":{"var":"ctx"},"default":null},"callstack":{"if":{"is_string":"biota.core@0.0.1+KeyRepsert"},"then":{"prepend":{"select":"callstack","from":{"var":"ctx"},"default":[]},"collection":["biota.core@0.0.1+KeyRepsert"]},"else":{"select":"callstack","from":{"var":"ctx"},"default":[]}},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"success":{"select":"success","from":{"var":"ctx"},"default":true}}}}],"in":{"let":[{"data":{"select":"data","from":{"var":"id"},"default":{"object":{}}}},{"schema":{"select":"response","from":{"call":"biota.schema@0.0.1+ValidateThrow","arguments":[{"var":"ctx"},{"object":{"code":"data_validation_failed","value":{"var":"id"},"options":{"object":{"type":"schema","schema":"biota.schema@0.0.1+Key.schema","options":{"object":{"optionals":"*"}}}},"state":{"object":{}}}}]},"default":{"object":{}}}}],"in":{"let":[{"response":{"if":{"select":"valid","from":{"select":"response","from":{"call":"biota.schema@0.0.1+Validate","arguments":[{"var":"ctx"},{"object":{"value":{"ref":{"keys":null},"id":{"var":"id"}},"options":{"object":{"type":"key"}},"state":{"object":{}}}}]},"default":{"object":{}}},"default":false},"then":{"select":"response","from":{"call":"biota.core@0.0.1+KeyReplace","arguments":[{"var":"ctx"},{"object":{"id":{"var":"id"},"options":{"var":"options"}}}]},"default":{"object":{}}},"else":{"select":"response","from":{"call":"biota.core@0.0.1+KeyInsert","arguments":[{"var":"ctx"},{"object":{"options":{"var":"options"}}}]},"default":{"object":{}}}}}],"in":{"object":{"response":{"var":"response"},"success":{"select":"success","from":{"var":"ctx"},"default":true},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"ts":{"now":null}}}}}}}}],"in":{"var":"biota.core@0.0.1+KeyRepsert"}}}}}}},"else":{"create_function":{"object":{"name":"biota.core@0.0.1+KeyRepsert","body":{"query":{"lambda":["ctx","params"],"expr":{"let":[{"biota.core@0.0.1+KeyRepsert":{"let":[{"data":{"object":{}}},{"ref":{"object":{}}},{"id":{"select":"id","from":{"var":"params"},"default":null}},{"options":{"select":"options","from":{"var":"params"},"default":{"object":{}}}},{"_inputs":{"object":{"id":{"select":"id","from":{"var":"params"},"default":null},"options":{"select":"options","from":{"var":"params"},"default":{"object":{}}}}}},{"annotate":{"object":{}}}],"in":{"let":[{"ctx":{"object":{}}},{"ctx":{"object":{"identity":{"select":"identity","from":{"var":"ctx"},"default":null},"session":{"select":"session","from":{"var":"ctx"},"default":null},"callstack":{"if":{"is_string":"biota.core@0.0.1+KeyRepsert"},"then":{"prepend":{"select":"callstack","from":{"var":"ctx"},"default":[]},"collection":["biota.core@0.0.1+KeyRepsert"]},"else":{"select":"callstack","from":{"var":"ctx"},"default":[]}},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"success":{"select":"success","from":{"var":"ctx"},"default":true}}}}],"in":{"let":[{"data":{"select":"data","from":{"var":"id"},"default":{"object":{}}}},{"schema":{"select":"response","from":{"call":"biota.schema@0.0.1+ValidateThrow","arguments":[{"var":"ctx"},{"object":{"code":"data_validation_failed","value":{"var":"id"},"options":{"object":{"type":"schema","schema":"biota.schema@0.0.1+Key.schema","options":{"object":{"optionals":"*"}}}},"state":{"object":{}}}}]},"default":{"object":{}}}}],"in":{"let":[{"response":{"if":{"select":"valid","from":{"select":"response","from":{"call":"biota.schema@0.0.1+Validate","arguments":[{"var":"ctx"},{"object":{"value":{"ref":{"keys":null},"id":{"var":"id"}},"options":{"object":{"type":"key"}},"state":{"object":{}}}}]},"default":{"object":{}}},"default":false},"then":{"select":"response","from":{"call":"biota.core@0.0.1+KeyReplace","arguments":[{"var":"ctx"},{"object":{"id":{"var":"id"},"options":{"var":"options"}}}]},"default":{"object":{}}},"else":{"select":"response","from":{"call":"biota.core@0.0.1+KeyInsert","arguments":[{"var":"ctx"},{"object":{"options":{"var":"options"}}}]},"default":{"object":{}}}}}],"in":{"object":{"response":{"var":"response"},"success":{"select":"success","from":{"var":"ctx"},"default":true},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"ts":{"now":null}}}}}}}}],"in":{"var":"biota.core@0.0.1+KeyRepsert"}}}}}}}}}},{"object":{"name":"biota.core@0.0.1+KeyDelete","expression":{"if":{"exists":{"function":"biota.core@0.0.1+KeyDelete"}},"then":{"replace":{"function":"biota.core@0.0.1+KeyDelete"},"params":{"object":{"name":"biota.core@0.0.1+KeyDelete","body":{"query":{"lambda":["ctx","params"],"expr":{"let":[{"biota.core@0.0.1+KeyDelete":{"let":[{"data":{"object":{}}},{"ref":{"object":{}}},{"id":{"select":"id","from":{"var":"params"},"default":null}},{"_inputs":{"object":{"id":{"select":"id","from":{"var":"params"},"default":null}}}},{"annotate":{"object":{}}}],"in":{"let":[{"ctx":{"object":{}}},{"ctx":{"object":{"identity":{"select":"identity","from":{"var":"ctx"},"default":null},"session":{"select":"session","from":{"var":"ctx"},"default":null},"callstack":{"if":{"is_string":"biota.core@0.0.1+KeyDelete"},"then":{"prepend":{"select":"callstack","from":{"var":"ctx"},"default":[]},"collection":["biota.core@0.0.1+KeyDelete"]},"else":{"select":"callstack","from":{"var":"ctx"},"default":[]}},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"success":{"select":"success","from":{"var":"ctx"},"default":true}}}}],"in":{"let":[{"ref":{"ref":{"keys":null},"id":{"var":"id"}}},{"valid":{"select":"response","from":{"call":"biota.schema@0.0.1+ValidateThrow","arguments":[{"var":"ctx"},{"object":{"code":"instance_not_found","value":{"var":"ref"},"options":{"object":{"type":"key"}},"state":{"object":{}}}}]},"default":{"object":{}}}}],"in":{"let":[{"annotationName":"delete"},{"annotationData":{"var":"data"}},{"annotationInputs":{"var":"annotate"}},{"data":{"select":"response","from":{"call":"biota.builder@0.0.1+Annotate","arguments":[{"var":"ctx"},{"object":{"action":{"var":"annotationName"},"data":{"var":"annotationData"},"input":{"var":"annotationInputs"}}}]},"default":{"object":{}}}}],"in":{"let":[{"response":{"select":"response","from":{"call":"biota.core@0.0.1+KeyUpsert","arguments":[{"var":"ctx"},{"object":{"id":{"var":"id"},"options":{"object":{"data":{"var":"data"}}}}}]},"default":{"object":{}}}}],"in":{"let":[{"actionName":"delete"},{"actionRef":{"select":"ref","from":{"var":"response"},"default":null}},{"data":{"if":{"not":{"is_null":{"var":"actionRef"}}},"then":{"select":"response","from":{"call":"biota.builder@0.0.1+ActionLog","arguments":[{"var":"ctx"},{"object":{"name":{"var":"actionName"},"instance":{"var":"actionRef"}}}]},"default":{"object":{}}},"else":""}}],"in":{"object":{"response":{"var":"response"},"success":{"select":"success","from":{"var":"ctx"},"default":true},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"ts":{"now":null}}}}}}}}}}],"in":{"var":"biota.core@0.0.1+KeyDelete"}}}}}}},"else":{"create_function":{"object":{"name":"biota.core@0.0.1+KeyDelete","body":{"query":{"lambda":["ctx","params"],"expr":{"let":[{"biota.core@0.0.1+KeyDelete":{"let":[{"data":{"object":{}}},{"ref":{"object":{}}},{"id":{"select":"id","from":{"var":"params"},"default":null}},{"_inputs":{"object":{"id":{"select":"id","from":{"var":"params"},"default":null}}}},{"annotate":{"object":{}}}],"in":{"let":[{"ctx":{"object":{}}},{"ctx":{"object":{"identity":{"select":"identity","from":{"var":"ctx"},"default":null},"session":{"select":"session","from":{"var":"ctx"},"default":null},"callstack":{"if":{"is_string":"biota.core@0.0.1+KeyDelete"},"then":{"prepend":{"select":"callstack","from":{"var":"ctx"},"default":[]},"collection":["biota.core@0.0.1+KeyDelete"]},"else":{"select":"callstack","from":{"var":"ctx"},"default":[]}},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"success":{"select":"success","from":{"var":"ctx"},"default":true}}}}],"in":{"let":[{"ref":{"ref":{"keys":null},"id":{"var":"id"}}},{"valid":{"select":"response","from":{"call":"biota.schema@0.0.1+ValidateThrow","arguments":[{"var":"ctx"},{"object":{"code":"instance_not_found","value":{"var":"ref"},"options":{"object":{"type":"key"}},"state":{"object":{}}}}]},"default":{"object":{}}}}],"in":{"let":[{"annotationName":"delete"},{"annotationData":{"var":"data"}},{"annotationInputs":{"var":"annotate"}},{"data":{"select":"response","from":{"call":"biota.builder@0.0.1+Annotate","arguments":[{"var":"ctx"},{"object":{"action":{"var":"annotationName"},"data":{"var":"annotationData"},"input":{"var":"annotationInputs"}}}]},"default":{"object":{}}}}],"in":{"let":[{"response":{"select":"response","from":{"call":"biota.core@0.0.1+KeyUpsert","arguments":[{"var":"ctx"},{"object":{"id":{"var":"id"},"options":{"object":{"data":{"var":"data"}}}}}]},"default":{"object":{}}}}],"in":{"let":[{"actionName":"delete"},{"actionRef":{"select":"ref","from":{"var":"response"},"default":null}},{"data":{"if":{"not":{"is_null":{"var":"actionRef"}}},"then":{"select":"response","from":{"call":"biota.builder@0.0.1+ActionLog","arguments":[{"var":"ctx"},{"object":{"name":{"var":"actionName"},"instance":{"var":"actionRef"}}}]},"default":{"object":{}}},"else":""}}],"in":{"object":{"response":{"var":"response"},"success":{"select":"success","from":{"var":"ctx"},"default":true},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"ts":{"now":null}}}}}}}}}}],"in":{"var":"biota.core@0.0.1+KeyDelete"}}}}}}}}}},{"object":{"name":"biota.core@0.0.1+KeyRestore","expression":{"if":{"exists":{"function":"biota.core@0.0.1+KeyRestore"}},"then":{"replace":{"function":"biota.core@0.0.1+KeyRestore"},"params":{"object":{"name":"biota.core@0.0.1+KeyRestore","body":{"query":{"lambda":["ctx","params"],"expr":{"let":[{"biota.core@0.0.1+KeyRestore":{"let":[{"data":{"object":{}}},{"ref":{"object":{}}},{"id":{"select":"id","from":{"var":"params"},"default":null}},{"_inputs":{"object":{"id":{"select":"id","from":{"var":"params"},"default":null}}}},{"annotate":{"object":{}}}],"in":{"let":[{"ctx":{"object":{}}},{"ctx":{"object":{"identity":{"select":"identity","from":{"var":"ctx"},"default":null},"session":{"select":"session","from":{"var":"ctx"},"default":null},"callstack":{"if":{"is_string":"biota.core@0.0.1+KeyRestore"},"then":{"prepend":{"select":"callstack","from":{"var":"ctx"},"default":[]},"collection":["biota.core@0.0.1+KeyRestore"]},"else":{"select":"callstack","from":{"var":"ctx"},"default":[]}},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"success":{"select":"success","from":{"var":"ctx"},"default":true}}}}],"in":{"let":[{"ref":{"ref":{"keys":null},"id":{"var":"id"}}},{"valid":{"select":"response","from":{"call":"biota.schema@0.0.1+ValidateThrow","arguments":[{"var":"ctx"},{"object":{"code":"instance_not_found","value":{"var":"ref"},"options":{"object":{"type":"key"}},"state":{"object":{}}}}]},"default":{"object":{}}}},{"doc":{"select":"response","from":{"call":"biota.core@0.0.1+KeyGet","arguments":[{"var":"ctx"},{"object":{"id":{"var":"id"}}}]},"default":{"object":{}}}},{"data":{"select":"data","from":{"var":"doc"},"default":{"object":{}}}},{"isDeleted":{"select":"response","from":{"call":"biota.core@0.0.1+DataIsDeleted","arguments":[{"var":"ctx"},{"object":{"data":{"var":"data"}}}]},"default":{"object":{}}}},{"isExpired":{"select":"response","from":{"call":"biota.core@0.0.1+DataIsExpired","arguments":[{"var":"ctx"},{"object":{"data":{"var":"data"}}}]},"default":{"object":{}}}}],"in":{"let":[{"annotationName":"restore"},{"annotationData":{"var":"data"}},{"annotationInputs":{"var":"annotate"}},{"data":{"select":"response","from":{"call":"biota.builder@0.0.1+Annotate","arguments":[{"var":"ctx"},{"object":{"action":{"var":"annotationName"},"data":{"var":"annotationData"},"input":{"var":"annotationInputs"}}}]},"default":{"object":{}}}}],"in":{"let":[{"response":{"select":"response","from":{"call":"biota.core@0.0.1+KeyUpsert","arguments":[{"var":"ctx"},{"object":{"id":{"var":"id"},"options":{"object":{"data":{"var":"data"}}}}}]},"default":{"object":{}}}}],"in":{"let":[{"actionName":"restore"},{"actionRef":{"select":"ref","from":{"var":"response"},"default":null}},{"data":{"if":{"not":{"is_null":{"var":"actionRef"}}},"then":{"select":"response","from":{"call":"biota.builder@0.0.1+ActionLog","arguments":[{"var":"ctx"},{"object":{"name":{"var":"actionName"},"instance":{"var":"actionRef"}}}]},"default":{"object":{}}},"else":""}}],"in":{"object":{"response":{"var":"response"},"success":{"select":"success","from":{"var":"ctx"},"default":true},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"ts":{"now":null}}}}}}}}}}],"in":{"var":"biota.core@0.0.1+KeyRestore"}}}}}}},"else":{"create_function":{"object":{"name":"biota.core@0.0.1+KeyRestore","body":{"query":{"lambda":["ctx","params"],"expr":{"let":[{"biota.core@0.0.1+KeyRestore":{"let":[{"data":{"object":{}}},{"ref":{"object":{}}},{"id":{"select":"id","from":{"var":"params"},"default":null}},{"_inputs":{"object":{"id":{"select":"id","from":{"var":"params"},"default":null}}}},{"annotate":{"object":{}}}],"in":{"let":[{"ctx":{"object":{}}},{"ctx":{"object":{"identity":{"select":"identity","from":{"var":"ctx"},"default":null},"session":{"select":"session","from":{"var":"ctx"},"default":null},"callstack":{"if":{"is_string":"biota.core@0.0.1+KeyRestore"},"then":{"prepend":{"select":"callstack","from":{"var":"ctx"},"default":[]},"collection":["biota.core@0.0.1+KeyRestore"]},"else":{"select":"callstack","from":{"var":"ctx"},"default":[]}},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"success":{"select":"success","from":{"var":"ctx"},"default":true}}}}],"in":{"let":[{"ref":{"ref":{"keys":null},"id":{"var":"id"}}},{"valid":{"select":"response","from":{"call":"biota.schema@0.0.1+ValidateThrow","arguments":[{"var":"ctx"},{"object":{"code":"instance_not_found","value":{"var":"ref"},"options":{"object":{"type":"key"}},"state":{"object":{}}}}]},"default":{"object":{}}}},{"doc":{"select":"response","from":{"call":"biota.core@0.0.1+KeyGet","arguments":[{"var":"ctx"},{"object":{"id":{"var":"id"}}}]},"default":{"object":{}}}},{"data":{"select":"data","from":{"var":"doc"},"default":{"object":{}}}},{"isDeleted":{"select":"response","from":{"call":"biota.core@0.0.1+DataIsDeleted","arguments":[{"var":"ctx"},{"object":{"data":{"var":"data"}}}]},"default":{"object":{}}}},{"isExpired":{"select":"response","from":{"call":"biota.core@0.0.1+DataIsExpired","arguments":[{"var":"ctx"},{"object":{"data":{"var":"data"}}}]},"default":{"object":{}}}}],"in":{"let":[{"annotationName":"restore"},{"annotationData":{"var":"data"}},{"annotationInputs":{"var":"annotate"}},{"data":{"select":"response","from":{"call":"biota.builder@0.0.1+Annotate","arguments":[{"var":"ctx"},{"object":{"action":{"var":"annotationName"},"data":{"var":"annotationData"},"input":{"var":"annotationInputs"}}}]},"default":{"object":{}}}}],"in":{"let":[{"response":{"select":"response","from":{"call":"biota.core@0.0.1+KeyUpsert","arguments":[{"var":"ctx"},{"object":{"id":{"var":"id"},"options":{"object":{"data":{"var":"data"}}}}}]},"default":{"object":{}}}}],"in":{"let":[{"actionName":"restore"},{"actionRef":{"select":"ref","from":{"var":"response"},"default":null}},{"data":{"if":{"not":{"is_null":{"var":"actionRef"}}},"then":{"select":"response","from":{"call":"biota.builder@0.0.1+ActionLog","arguments":[{"var":"ctx"},{"object":{"name":{"var":"actionName"},"instance":{"var":"actionRef"}}}]},"default":{"object":{}}},"else":""}}],"in":{"object":{"response":{"var":"response"},"success":{"select":"success","from":{"var":"ctx"},"default":true},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"ts":{"now":null}}}}}}}}}}],"in":{"var":"biota.core@0.0.1+KeyRestore"}}}}}}}}}},{"object":{"name":"biota.core@0.0.1+KeyForget","expression":{"if":{"exists":{"function":"biota.core@0.0.1+KeyForget"}},"then":{"replace":{"function":"biota.core@0.0.1+KeyForget"},"params":{"object":{"name":"biota.core@0.0.1+KeyForget","body":{"query":{"lambda":["ctx","params"],"expr":{"let":[{"biota.core@0.0.1+KeyForget":{"let":[{"data":{"object":{}}},{"ref":{"object":{}}},{"id":{"select":"id","from":{"var":"params"},"default":null}},{"_inputs":{"object":{"id":{"select":"id","from":{"var":"params"},"default":null}}}},{"annotate":{"object":{}}}],"in":{"let":[{"ctx":{"object":{}}},{"ctx":{"object":{"identity":{"select":"identity","from":{"var":"ctx"},"default":null},"session":{"select":"session","from":{"var":"ctx"},"default":null},"callstack":{"if":{"is_string":"biota.core@0.0.1+KeyForget"},"then":{"prepend":{"select":"callstack","from":{"var":"ctx"},"default":[]},"collection":["biota.core@0.0.1+KeyForget"]},"else":{"select":"callstack","from":{"var":"ctx"},"default":[]}},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"success":{"select":"success","from":{"var":"ctx"},"default":true}}}}],"in":{"let":[{"ref":{"ref":{"keys":null},"id":{"var":"id"}}},{"valid":{"select":"response","from":{"call":"biota.schema@0.0.1+ValidateThrow","arguments":[{"var":"ctx"},{"object":{"code":"instance_not_found","value":{"var":"ref"},"options":{"object":{"type":"key"}},"state":{"object":{}}}}]},"default":{"object":{}}}}],"in":{"let":[{"annotationName":"forget"},{"annotationData":{"var":"data"}},{"annotationInputs":{"var":"annotate"}},{"data":{"select":"response","from":{"call":"biota.builder@0.0.1+Annotate","arguments":[{"var":"ctx"},{"object":{"action":{"var":"annotationName"},"data":{"var":"annotationData"},"input":{"var":"annotationInputs"}}}]},"default":{"object":{}}}}],"in":{"let":[{"response":{"select":"response","from":{"call":"biota.core@0.0.1+KeyUpsert","arguments":[{"var":"ctx"},{"object":{"id":{"var":"id"},"options":{"object":{"data":{"var":"data"}}}}}]},"default":{"object":{}}}}],"in":{"let":[{"actionName":"forget"},{"actionRef":{"select":"ref","from":{"var":"response"},"default":null}},{"data":{"if":{"not":{"is_null":{"var":"actionRef"}}},"then":{"select":"response","from":{"call":"biota.builder@0.0.1+ActionLog","arguments":[{"var":"ctx"},{"object":{"name":{"var":"actionName"},"instance":{"var":"actionRef"}}}]},"default":{"object":{}}},"else":""}}],"in":{"let":[{"response":{"delete":{"ref":{"keys":null},"id":{"var":"id"}}}}],"in":{"object":{"response":{"var":"response"},"success":{"select":"success","from":{"var":"ctx"},"default":true},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"ts":{"now":null}}}}}}}}}}}],"in":{"var":"biota.core@0.0.1+KeyForget"}}}}}}},"else":{"create_function":{"object":{"name":"biota.core@0.0.1+KeyForget","body":{"query":{"lambda":["ctx","params"],"expr":{"let":[{"biota.core@0.0.1+KeyForget":{"let":[{"data":{"object":{}}},{"ref":{"object":{}}},{"id":{"select":"id","from":{"var":"params"},"default":null}},{"_inputs":{"object":{"id":{"select":"id","from":{"var":"params"},"default":null}}}},{"annotate":{"object":{}}}],"in":{"let":[{"ctx":{"object":{}}},{"ctx":{"object":{"identity":{"select":"identity","from":{"var":"ctx"},"default":null},"session":{"select":"session","from":{"var":"ctx"},"default":null},"callstack":{"if":{"is_string":"biota.core@0.0.1+KeyForget"},"then":{"prepend":{"select":"callstack","from":{"var":"ctx"},"default":[]},"collection":["biota.core@0.0.1+KeyForget"]},"else":{"select":"callstack","from":{"var":"ctx"},"default":[]}},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"success":{"select":"success","from":{"var":"ctx"},"default":true}}}}],"in":{"let":[{"ref":{"ref":{"keys":null},"id":{"var":"id"}}},{"valid":{"select":"response","from":{"call":"biota.schema@0.0.1+ValidateThrow","arguments":[{"var":"ctx"},{"object":{"code":"instance_not_found","value":{"var":"ref"},"options":{"object":{"type":"key"}},"state":{"object":{}}}}]},"default":{"object":{}}}}],"in":{"let":[{"annotationName":"forget"},{"annotationData":{"var":"data"}},{"annotationInputs":{"var":"annotate"}},{"data":{"select":"response","from":{"call":"biota.builder@0.0.1+Annotate","arguments":[{"var":"ctx"},{"object":{"action":{"var":"annotationName"},"data":{"var":"annotationData"},"input":{"var":"annotationInputs"}}}]},"default":{"object":{}}}}],"in":{"let":[{"response":{"select":"response","from":{"call":"biota.core@0.0.1+KeyUpsert","arguments":[{"var":"ctx"},{"object":{"id":{"var":"id"},"options":{"object":{"data":{"var":"data"}}}}}]},"default":{"object":{}}}}],"in":{"let":[{"actionName":"forget"},{"actionRef":{"select":"ref","from":{"var":"response"},"default":null}},{"data":{"if":{"not":{"is_null":{"var":"actionRef"}}},"then":{"select":"response","from":{"call":"biota.builder@0.0.1+ActionLog","arguments":[{"var":"ctx"},{"object":{"name":{"var":"actionName"},"instance":{"var":"actionRef"}}}]},"default":{"object":{}}},"else":""}}],"in":{"let":[{"response":{"delete":{"ref":{"keys":null},"id":{"var":"id"}}}}],"in":{"object":{"response":{"var":"response"},"success":{"select":"success","from":{"var":"ctx"},"default":true},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"ts":{"now":null}}}}}}}}}}}],"in":{"var":"biota.core@0.0.1+KeyForget"}}}}}}}}}},{"object":{"name":"biota.core@0.0.1+KeyDrop","expression":{"if":{"exists":{"function":"biota.core@0.0.1+KeyDrop"}},"then":{"replace":{"function":"biota.core@0.0.1+KeyDrop"},"params":{"object":{"name":"biota.core@0.0.1+KeyDrop","body":{"query":{"lambda":["ctx","params"],"expr":{"let":[{"biota.core@0.0.1+KeyDrop":{"let":[{"data":{"object":{}}},{"ref":{"object":{}}},{"id":{"select":"id","from":{"var":"params"},"default":null}},{"_inputs":{"object":{"id":{"select":"id","from":{"var":"params"},"default":null}}}},{"annotate":{"object":{}}}],"in":{"let":[{"ctx":{"object":{}}},{"ctx":{"object":{"identity":{"select":"identity","from":{"var":"ctx"},"default":null},"session":{"select":"session","from":{"var":"ctx"},"default":null},"callstack":{"if":{"is_string":"biota.core@0.0.1+KeyDrop"},"then":{"prepend":{"select":"callstack","from":{"var":"ctx"},"default":[]},"collection":["biota.core@0.0.1+KeyDrop"]},"else":{"select":"callstack","from":{"var":"ctx"},"default":[]}},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"success":{"select":"success","from":{"var":"ctx"},"default":true}}}}],"in":{"let":[{"ref":{"ref":{"keys":null},"id":{"var":"id"}}},{"valid":{"select":"response","from":{"call":"biota.schema@0.0.1+ValidateThrow","arguments":[{"var":"ctx"},{"object":{"code":"instance_not_found","value":{"var":"ref"},"options":{"object":{"type":"key"}},"state":{"object":{}}}}]},"default":{"object":{}}}}],"in":{"let":[{"response":{"if":{"select":"valid","from":{"select":"response","from":{"call":"biota.schema@0.0.1+Validate","arguments":[{"var":"ctx"},{"object":{"value":{"var":"ref"},"options":{"object":{"type":"key"}},"state":{"object":{}}}}]},"default":{"object":{}}},"default":false},"then":{"select":"response","from":{"call":"biota.core@0.0.1+KeyForget","arguments":[{"var":"ctx"},{"object":{"id":{"var":"id"}}}]},"default":{"object":{}}},"else":{"object":{}}}}],"in":{"object":{"response":{"var":"response"},"success":{"select":"success","from":{"var":"ctx"},"default":true},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"ts":{"now":null}}}}}}}}],"in":{"var":"biota.core@0.0.1+KeyDrop"}}}}}}},"else":{"create_function":{"object":{"name":"biota.core@0.0.1+KeyDrop","body":{"query":{"lambda":["ctx","params"],"expr":{"let":[{"biota.core@0.0.1+KeyDrop":{"let":[{"data":{"object":{}}},{"ref":{"object":{}}},{"id":{"select":"id","from":{"var":"params"},"default":null}},{"_inputs":{"object":{"id":{"select":"id","from":{"var":"params"},"default":null}}}},{"annotate":{"object":{}}}],"in":{"let":[{"ctx":{"object":{}}},{"ctx":{"object":{"identity":{"select":"identity","from":{"var":"ctx"},"default":null},"session":{"select":"session","from":{"var":"ctx"},"default":null},"callstack":{"if":{"is_string":"biota.core@0.0.1+KeyDrop"},"then":{"prepend":{"select":"callstack","from":{"var":"ctx"},"default":[]},"collection":["biota.core@0.0.1+KeyDrop"]},"else":{"select":"callstack","from":{"var":"ctx"},"default":[]}},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"success":{"select":"success","from":{"var":"ctx"},"default":true}}}}],"in":{"let":[{"ref":{"ref":{"keys":null},"id":{"var":"id"}}},{"valid":{"select":"response","from":{"call":"biota.schema@0.0.1+ValidateThrow","arguments":[{"var":"ctx"},{"object":{"code":"instance_not_found","value":{"var":"ref"},"options":{"object":{"type":"key"}},"state":{"object":{}}}}]},"default":{"object":{}}}}],"in":{"let":[{"response":{"if":{"select":"valid","from":{"select":"response","from":{"call":"biota.schema@0.0.1+Validate","arguments":[{"var":"ctx"},{"object":{"value":{"var":"ref"},"options":{"object":{"type":"key"}},"state":{"object":{}}}}]},"default":{"object":{}}},"default":false},"then":{"select":"response","from":{"call":"biota.core@0.0.1+KeyForget","arguments":[{"var":"ctx"},{"object":{"id":{"var":"id"}}}]},"default":{"object":{}}},"else":{"object":{}}}}],"in":{"object":{"response":{"var":"response"},"success":{"select":"success","from":{"var":"ctx"},"default":true},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"ts":{"now":null}}}}}}}}],"in":{"var":"biota.core@0.0.1+KeyDrop"}}}}}}}}}},{"object":{"name":"biota.core@0.0.1+KeyExpire","expression":{"if":{"exists":{"function":"biota.core@0.0.1+KeyExpire"}},"then":{"replace":{"function":"biota.core@0.0.1+KeyExpire"},"params":{"object":{"name":"biota.core@0.0.1+KeyExpire","body":{"query":{"lambda":["ctx","params"],"expr":{"let":[{"biota.core@0.0.1+KeyExpire":{"let":[{"data":{"object":{}}},{"ref":{"object":{}}},{"id":{"select":"id","from":{"var":"params"},"default":null}},{"at":{"select":"at","from":{"var":"params"},"default":{"now":null}}},{"_inputs":{"object":{"id":{"select":"id","from":{"var":"params"},"default":null},"at":{"select":"at","from":{"var":"params"},"default":{"now":null}}}}},{"annotate":{"object":{}}}],"in":{"let":[{"ctx":{"object":{}}},{"ctx":{"object":{"identity":{"select":"identity","from":{"var":"ctx"},"default":null},"session":{"select":"session","from":{"var":"ctx"},"default":null},"callstack":{"if":{"is_string":"biota.core@0.0.1+KeyExpire"},"then":{"prepend":{"select":"callstack","from":{"var":"ctx"},"default":[]},"collection":["biota.core@0.0.1+KeyExpire"]},"else":{"select":"callstack","from":{"var":"ctx"},"default":[]}},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"success":{"select":"success","from":{"var":"ctx"},"default":true}}}}],"in":{"let":[{"isTime":{"select":"response","from":{"call":"biota.schema@0.0.1+ValidateThrow","arguments":[{"var":"ctx"},{"object":{"code":"data_validation_failed","value":{"var":"at"},"options":{"object":{"type":"time"}},"state":{"object":{}}}}]},"default":{"object":{}}}},{"ref":{"ref":{"keys":null},"id":{"var":"id"}}},{"valid":{"select":"response","from":{"call":"biota.schema@0.0.1+ValidateThrow","arguments":[{"var":"ctx"},{"object":{"code":"instance_not_found","value":{"var":"ref"},"options":{"object":{"type":"key"}},"state":{"object":{}}}}]},"default":{"object":{}}}},{"annotate":{"object":{"at":{"var":"at"}}}}],"in":{"let":[{"annotationName":"expire"},{"annotationData":{"var":"data"}},{"annotationInputs":{"var":"annotate"}},{"data":{"select":"response","from":{"call":"biota.builder@0.0.1+Annotate","arguments":[{"var":"ctx"},{"object":{"action":{"var":"annotationName"},"data":{"var":"annotationData"},"input":{"var":"annotationInputs"}}}]},"default":{"object":{}}}}],"in":{"let":[{"response":{"select":"response","from":{"call":"biota.core@0.0.1+KeyUpsert","arguments":[{"var":"ctx"},{"object":{"id":{"var":"id"},"options":{"object":{"data":{"var":"data"}}}}}]},"default":{"object":{}}}}],"in":{"let":[{"actionName":"expire"},{"actionRef":{"select":"ref","from":{"var":"response"},"default":null}},{"data":{"if":{"not":{"is_null":{"var":"actionRef"}}},"then":{"select":"response","from":{"call":"biota.builder@0.0.1+ActionLog","arguments":[{"var":"ctx"},{"object":{"name":{"var":"actionName"},"instance":{"var":"actionRef"}}}]},"default":{"object":{}}},"else":""}}],"in":{"object":{"response":{"var":"response"},"success":{"select":"success","from":{"var":"ctx"},"default":true},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"ts":{"now":null}}}}}}}}}}],"in":{"var":"biota.core@0.0.1+KeyExpire"}}}}}}},"else":{"create_function":{"object":{"name":"biota.core@0.0.1+KeyExpire","body":{"query":{"lambda":["ctx","params"],"expr":{"let":[{"biota.core@0.0.1+KeyExpire":{"let":[{"data":{"object":{}}},{"ref":{"object":{}}},{"id":{"select":"id","from":{"var":"params"},"default":null}},{"at":{"select":"at","from":{"var":"params"},"default":{"now":null}}},{"_inputs":{"object":{"id":{"select":"id","from":{"var":"params"},"default":null},"at":{"select":"at","from":{"var":"params"},"default":{"now":null}}}}},{"annotate":{"object":{}}}],"in":{"let":[{"ctx":{"object":{}}},{"ctx":{"object":{"identity":{"select":"identity","from":{"var":"ctx"},"default":null},"session":{"select":"session","from":{"var":"ctx"},"default":null},"callstack":{"if":{"is_string":"biota.core@0.0.1+KeyExpire"},"then":{"prepend":{"select":"callstack","from":{"var":"ctx"},"default":[]},"collection":["biota.core@0.0.1+KeyExpire"]},"else":{"select":"callstack","from":{"var":"ctx"},"default":[]}},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"success":{"select":"success","from":{"var":"ctx"},"default":true}}}}],"in":{"let":[{"isTime":{"select":"response","from":{"call":"biota.schema@0.0.1+ValidateThrow","arguments":[{"var":"ctx"},{"object":{"code":"data_validation_failed","value":{"var":"at"},"options":{"object":{"type":"time"}},"state":{"object":{}}}}]},"default":{"object":{}}}},{"ref":{"ref":{"keys":null},"id":{"var":"id"}}},{"valid":{"select":"response","from":{"call":"biota.schema@0.0.1+ValidateThrow","arguments":[{"var":"ctx"},{"object":{"code":"instance_not_found","value":{"var":"ref"},"options":{"object":{"type":"key"}},"state":{"object":{}}}}]},"default":{"object":{}}}},{"annotate":{"object":{"at":{"var":"at"}}}}],"in":{"let":[{"annotationName":"expire"},{"annotationData":{"var":"data"}},{"annotationInputs":{"var":"annotate"}},{"data":{"select":"response","from":{"call":"biota.builder@0.0.1+Annotate","arguments":[{"var":"ctx"},{"object":{"action":{"var":"annotationName"},"data":{"var":"annotationData"},"input":{"var":"annotationInputs"}}}]},"default":{"object":{}}}}],"in":{"let":[{"response":{"select":"response","from":{"call":"biota.core@0.0.1+KeyUpsert","arguments":[{"var":"ctx"},{"object":{"id":{"var":"id"},"options":{"object":{"data":{"var":"data"}}}}}]},"default":{"object":{}}}}],"in":{"let":[{"actionName":"expire"},{"actionRef":{"select":"ref","from":{"var":"response"},"default":null}},{"data":{"if":{"not":{"is_null":{"var":"actionRef"}}},"then":{"select":"response","from":{"call":"biota.builder@0.0.1+ActionLog","arguments":[{"var":"ctx"},{"object":{"name":{"var":"actionName"},"instance":{"var":"actionRef"}}}]},"default":{"object":{}}},"else":""}}],"in":{"object":{"response":{"var":"response"},"success":{"select":"success","from":{"var":"ctx"},"default":true},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"ts":{"now":null}}}}}}}}}}],"in":{"var":"biota.core@0.0.1+KeyExpire"}}}}}}}}}},{"object":{"name":"biota.core@0.0.1+KeyExpireIn","expression":{"if":{"exists":{"function":"biota.core@0.0.1+KeyExpireIn"}},"then":{"replace":{"function":"biota.core@0.0.1+KeyExpireIn"},"params":{"object":{"name":"biota.core@0.0.1+KeyExpireIn","body":{"query":{"lambda":["ctx","params"],"expr":{"let":[{"biota.core@0.0.1+KeyExpireIn":{"let":[{"data":{"object":{}}},{"ref":{"object":{}}},{"id":{"select":"id","from":{"var":"params"},"default":null}},{"delay":{"select":"delay","from":{"var":"params"},"default":0}},{"_inputs":{"object":{"id":{"select":"id","from":{"var":"params"},"default":null},"delay":{"select":"delay","from":{"var":"params"},"default":0}}}},{"annotate":{"object":{}}}],"in":{"let":[{"ctx":{"object":{}}},{"ctx":{"object":{"identity":{"select":"identity","from":{"var":"ctx"},"default":null},"session":{"select":"session","from":{"var":"ctx"},"default":null},"callstack":{"if":{"is_string":"biota.core@0.0.1+KeyExpireIn"},"then":{"prepend":{"select":"callstack","from":{"var":"ctx"},"default":[]},"collection":["biota.core@0.0.1+KeyExpireIn"]},"else":{"select":"callstack","from":{"var":"ctx"},"default":[]}},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"success":{"select":"success","from":{"var":"ctx"},"default":true}}}}],"in":{"let":[{"response":{"select":"response","from":{"call":"biota.core@0.0.1+KeyExpire","arguments":[{"var":"ctx"},{"object":{"id":{"var":"id"},"at":{"time_add":{"now":null},"offset":{"to_number":{"var":"delay"}},"unit":"milliseconds"}}}]},"default":{"object":{}}}}],"in":{"object":{"response":{"var":"response"},"success":{"select":"success","from":{"var":"ctx"},"default":true},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"ts":{"now":null}}}}}}}],"in":{"var":"biota.core@0.0.1+KeyExpireIn"}}}}}}},"else":{"create_function":{"object":{"name":"biota.core@0.0.1+KeyExpireIn","body":{"query":{"lambda":["ctx","params"],"expr":{"let":[{"biota.core@0.0.1+KeyExpireIn":{"let":[{"data":{"object":{}}},{"ref":{"object":{}}},{"id":{"select":"id","from":{"var":"params"},"default":null}},{"delay":{"select":"delay","from":{"var":"params"},"default":0}},{"_inputs":{"object":{"id":{"select":"id","from":{"var":"params"},"default":null},"delay":{"select":"delay","from":{"var":"params"},"default":0}}}},{"annotate":{"object":{}}}],"in":{"let":[{"ctx":{"object":{}}},{"ctx":{"object":{"identity":{"select":"identity","from":{"var":"ctx"},"default":null},"session":{"select":"session","from":{"var":"ctx"},"default":null},"callstack":{"if":{"is_string":"biota.core@0.0.1+KeyExpireIn"},"then":{"prepend":{"select":"callstack","from":{"var":"ctx"},"default":[]},"collection":["biota.core@0.0.1+KeyExpireIn"]},"else":{"select":"callstack","from":{"var":"ctx"},"default":[]}},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"success":{"select":"success","from":{"var":"ctx"},"default":true}}}}],"in":{"let":[{"response":{"select":"response","from":{"call":"biota.core@0.0.1+KeyExpire","arguments":[{"var":"ctx"},{"object":{"id":{"var":"id"},"at":{"time_add":{"now":null},"offset":{"to_number":{"var":"delay"}},"unit":"milliseconds"}}}]},"default":{"object":{}}}}],"in":{"object":{"response":{"var":"response"},"success":{"select":"success","from":{"var":"ctx"},"default":true},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"ts":{"now":null}}}}}}}],"in":{"var":"biota.core@0.0.1+KeyExpireIn"}}}}}}}}}},{"object":{"name":"biota.core@0.0.1+KeyExpireNow","expression":{"if":{"exists":{"function":"biota.core@0.0.1+KeyExpireNow"}},"then":{"replace":{"function":"biota.core@0.0.1+KeyExpireNow"},"params":{"object":{"name":"biota.core@0.0.1+KeyExpireNow","body":{"query":{"lambda":["ctx","params"],"expr":{"let":[{"biota.core@0.0.1+KeyExpireNow":{"let":[{"data":{"object":{}}},{"ref":{"object":{}}},{"id":{"select":"id","from":{"var":"params"},"default":null}},{"_inputs":{"object":{"id":{"select":"id","from":{"var":"params"},"default":null}}}},{"annotate":{"object":{}}}],"in":{"let":[{"ctx":{"object":{}}},{"ctx":{"object":{"identity":{"select":"identity","from":{"var":"ctx"},"default":null},"session":{"select":"session","from":{"var":"ctx"},"default":null},"callstack":{"if":{"is_string":"biota.core@0.0.1+KeyExpireNow"},"then":{"prepend":{"select":"callstack","from":{"var":"ctx"},"default":[]},"collection":["biota.core@0.0.1+KeyExpireNow"]},"else":{"select":"callstack","from":{"var":"ctx"},"default":[]}},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"success":{"select":"success","from":{"var":"ctx"},"default":true}}}}],"in":{"let":[{"response":{"select":"response","from":{"call":"biota.core@0.0.1+KeyExpire","arguments":[{"var":"ctx"},{"object":{"id":{"var":"id"},"at":{"now":null}}}]},"default":{"object":{}}}}],"in":{"object":{"response":{"var":"response"},"success":{"select":"success","from":{"var":"ctx"},"default":true},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"ts":{"now":null}}}}}}}],"in":{"var":"biota.core@0.0.1+KeyExpireNow"}}}}}}},"else":{"create_function":{"object":{"name":"biota.core@0.0.1+KeyExpireNow","body":{"query":{"lambda":["ctx","params"],"expr":{"let":[{"biota.core@0.0.1+KeyExpireNow":{"let":[{"data":{"object":{}}},{"ref":{"object":{}}},{"id":{"select":"id","from":{"var":"params"},"default":null}},{"_inputs":{"object":{"id":{"select":"id","from":{"var":"params"},"default":null}}}},{"annotate":{"object":{}}}],"in":{"let":[{"ctx":{"object":{}}},{"ctx":{"object":{"identity":{"select":"identity","from":{"var":"ctx"},"default":null},"session":{"select":"session","from":{"var":"ctx"},"default":null},"callstack":{"if":{"is_string":"biota.core@0.0.1+KeyExpireNow"},"then":{"prepend":{"select":"callstack","from":{"var":"ctx"},"default":[]},"collection":["biota.core@0.0.1+KeyExpireNow"]},"else":{"select":"callstack","from":{"var":"ctx"},"default":[]}},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"success":{"select":"success","from":{"var":"ctx"},"default":true}}}}],"in":{"let":[{"response":{"select":"response","from":{"call":"biota.core@0.0.1+KeyExpire","arguments":[{"var":"ctx"},{"object":{"id":{"var":"id"},"at":{"now":null}}}]},"default":{"object":{}}}}],"in":{"object":{"response":{"var":"response"},"success":{"select":"success","from":{"var":"ctx"},"default":true},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"ts":{"now":null}}}}}}}],"in":{"var":"biota.core@0.0.1+KeyExpireNow"}}}}}}}}}},{"object":{"name":"biota.core@0.0.1+KeysGetAll","expression":{"if":{"exists":{"function":"biota.core@0.0.1+KeysGetAll"}},"then":{"replace":{"function":"biota.core@0.0.1+KeysGetAll"},"params":{"object":{"name":"biota.core@0.0.1+KeysGetAll","body":{"query":{"lambda":["ctx","params"],"expr":{"let":[{"biota.core@0.0.1+KeysGetAll":{"let":[{"data":{"object":{}}},{"ref":{"object":{}}},{"pagination":{"select":"pagination","from":{"var":"params"},"default":{"object":{}}}},{"_inputs":{"object":{"pagination":{"select":"pagination","from":{"var":"params"},"default":{"object":{}}}}}},{"annotate":{"object":{}}}],"in":{"let":[{"ctx":{"object":{}}},{"ctx":{"object":{"identity":{"select":"identity","from":{"var":"ctx"},"default":null},"session":{"select":"session","from":{"var":"ctx"},"default":null},"callstack":{"if":{"is_string":"biota.core@0.0.1+KeysGetAll"},"then":{"prepend":{"select":"callstack","from":{"var":"ctx"},"default":[]},"collection":["biota.core@0.0.1+KeysGetAll"]},"else":{"select":"callstack","from":{"var":"ctx"},"default":[]}},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"success":{"select":"success","from":{"var":"ctx"},"default":true}}}}],"in":{"let":[{"response":{"map":{"lambda":"x","expr":{"get":{"var":"x"}}},"collection":{"if":{"contains":["before"],"in":{"var":"pagination"}},"then":{"paginate":{"keys":null},"before":{"select":"before","from":{"var":"pagination"},"default":null},"size":{"select":"size","from":{"var":"pagination"},"default":100},"events":{"select":"events","from":{"var":"pagination"},"default":false},"ts":{"select":"ts","from":{"var":"pagination"},"default":{"now":null}}},"else":{"if":{"contains":["after"],"in":{"var":"pagination"}},"then":{"paginate":{"keys":null},"after":{"select":"after","from":{"var":"pagination"},"default":0},"size":{"select":"size","from":{"var":"pagination"},"default":100},"events":{"select":"events","from":{"var":"pagination"},"default":false},"ts":{"select":"ts","from":{"var":"pagination"},"default":{"now":null}}},"else":{"paginate":{"keys":null},"size":{"select":"size","from":{"var":"pagination"},"default":100},"events":{"select":"events","from":{"var":"pagination"},"default":false},"ts":{"select":"ts","from":{"var":"pagination"},"default":{"now":null}}}}}}}],"in":{"object":{"response":{"var":"response"},"success":{"select":"success","from":{"var":"ctx"},"default":true},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"ts":{"now":null}}}}}}}],"in":{"var":"biota.core@0.0.1+KeysGetAll"}}}}}}},"else":{"create_function":{"object":{"name":"biota.core@0.0.1+KeysGetAll","body":{"query":{"lambda":["ctx","params"],"expr":{"let":[{"biota.core@0.0.1+KeysGetAll":{"let":[{"data":{"object":{}}},{"ref":{"object":{}}},{"pagination":{"select":"pagination","from":{"var":"params"},"default":{"object":{}}}},{"_inputs":{"object":{"pagination":{"select":"pagination","from":{"var":"params"},"default":{"object":{}}}}}},{"annotate":{"object":{}}}],"in":{"let":[{"ctx":{"object":{}}},{"ctx":{"object":{"identity":{"select":"identity","from":{"var":"ctx"},"default":null},"session":{"select":"session","from":{"var":"ctx"},"default":null},"callstack":{"if":{"is_string":"biota.core@0.0.1+KeysGetAll"},"then":{"prepend":{"select":"callstack","from":{"var":"ctx"},"default":[]},"collection":["biota.core@0.0.1+KeysGetAll"]},"else":{"select":"callstack","from":{"var":"ctx"},"default":[]}},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"success":{"select":"success","from":{"var":"ctx"},"default":true}}}}],"in":{"let":[{"response":{"map":{"lambda":"x","expr":{"get":{"var":"x"}}},"collection":{"if":{"contains":["before"],"in":{"var":"pagination"}},"then":{"paginate":{"keys":null},"before":{"select":"before","from":{"var":"pagination"},"default":null},"size":{"select":"size","from":{"var":"pagination"},"default":100},"events":{"select":"events","from":{"var":"pagination"},"default":false},"ts":{"select":"ts","from":{"var":"pagination"},"default":{"now":null}}},"else":{"if":{"contains":["after"],"in":{"var":"pagination"}},"then":{"paginate":{"keys":null},"after":{"select":"after","from":{"var":"pagination"},"default":0},"size":{"select":"size","from":{"var":"pagination"},"default":100},"events":{"select":"events","from":{"var":"pagination"},"default":false},"ts":{"select":"ts","from":{"var":"pagination"},"default":{"now":null}}},"else":{"paginate":{"keys":null},"size":{"select":"size","from":{"var":"pagination"},"default":100},"events":{"select":"events","from":{"var":"pagination"},"default":false},"ts":{"select":"ts","from":{"var":"pagination"},"default":{"now":null}}}}}}}],"in":{"object":{"response":{"var":"response"},"success":{"select":"success","from":{"var":"ctx"},"default":true},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"ts":{"now":null}}}}}}}],"in":{"var":"biota.core@0.0.1+KeysGetAll"}}}}}}}}}},{"object":{"name":"biota.core@0.0.1+KeysGetMany","expression":{"if":{"exists":{"function":"biota.core@0.0.1+KeysGetMany"}},"then":{"replace":{"function":"biota.core@0.0.1+KeysGetMany"},"params":{"object":{"name":"biota.core@0.0.1+KeysGetMany","body":{"query":{"lambda":["ctx","params"],"expr":{"let":[{"biota.core@0.0.1+KeysGetMany":{"let":[{"data":{"object":{}}},{"ref":{"object":{}}},{"namesList":{"select":"namesList","from":{"var":"params"},"default":[]}},{"_inputs":{"object":{"namesList":{"select":"namesList","from":{"var":"params"},"default":[]}}}},{"annotate":{"object":{}}}],"in":{"let":[{"ctx":{"object":{}}},{"ctx":{"object":{"identity":{"select":"identity","from":{"var":"ctx"},"default":null},"session":{"select":"session","from":{"var":"ctx"},"default":null},"callstack":{"if":{"is_string":"biota.core@0.0.1+KeysGetMany"},"then":{"prepend":{"select":"callstack","from":{"var":"ctx"},"default":[]},"collection":["biota.core@0.0.1+KeysGetMany"]},"else":{"select":"callstack","from":{"var":"ctx"},"default":[]}},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"success":{"select":"success","from":{"var":"ctx"},"default":true}}}}],"in":{"let":[{"response":{"map":{"lambda":["name"],"expr":{"select":"response","from":{"call":"biota.core@0.0.1+KeyGet","arguments":[{"var":"ctx"},{"object":{"id":{"var":"name"}}}]},"default":{"object":{}}}},"collection":{"var":"namesList"}}}],"in":{"object":{"response":{"var":"response"},"success":{"select":"success","from":{"var":"ctx"},"default":true},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"ts":{"now":null}}}}}}}],"in":{"var":"biota.core@0.0.1+KeysGetMany"}}}}}}},"else":{"create_function":{"object":{"name":"biota.core@0.0.1+KeysGetMany","body":{"query":{"lambda":["ctx","params"],"expr":{"let":[{"biota.core@0.0.1+KeysGetMany":{"let":[{"data":{"object":{}}},{"ref":{"object":{}}},{"namesList":{"select":"namesList","from":{"var":"params"},"default":[]}},{"_inputs":{"object":{"namesList":{"select":"namesList","from":{"var":"params"},"default":[]}}}},{"annotate":{"object":{}}}],"in":{"let":[{"ctx":{"object":{}}},{"ctx":{"object":{"identity":{"select":"identity","from":{"var":"ctx"},"default":null},"session":{"select":"session","from":{"var":"ctx"},"default":null},"callstack":{"if":{"is_string":"biota.core@0.0.1+KeysGetMany"},"then":{"prepend":{"select":"callstack","from":{"var":"ctx"},"default":[]},"collection":["biota.core@0.0.1+KeysGetMany"]},"else":{"select":"callstack","from":{"var":"ctx"},"default":[]}},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"success":{"select":"success","from":{"var":"ctx"},"default":true}}}}],"in":{"let":[{"response":{"map":{"lambda":["name"],"expr":{"select":"response","from":{"call":"biota.core@0.0.1+KeyGet","arguments":[{"var":"ctx"},{"object":{"id":{"var":"name"}}}]},"default":{"object":{}}}},"collection":{"var":"namesList"}}}],"in":{"object":{"response":{"var":"response"},"success":{"select":"success","from":{"var":"ctx"},"default":true},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"ts":{"now":null}}}}}}}],"in":{"var":"biota.core@0.0.1+KeysGetMany"}}}}}}}}}},{"object":{"name":"biota.core@0.0.1+KeysInsertMany","expression":{"if":{"exists":{"function":"biota.core@0.0.1+KeysInsertMany"}},"then":{"replace":{"function":"biota.core@0.0.1+KeysInsertMany"},"params":{"object":{"name":"biota.core@0.0.1+KeysInsertMany","body":{"query":{"lambda":["ctx","params"],"expr":{"let":[{"biota.core@0.0.1+KeysInsertMany":{"let":[{"data":{"object":{}}},{"ref":{"object":{}}},{"optionsList":{"select":"optionsList","from":{"var":"params"},"default":[]}},{"_inputs":{"object":{"optionsList":{"select":"optionsList","from":{"var":"params"},"default":[]}}}},{"annotate":{"object":{}}}],"in":{"let":[{"ctx":{"object":{}}},{"ctx":{"object":{"identity":{"select":"identity","from":{"var":"ctx"},"default":null},"session":{"select":"session","from":{"var":"ctx"},"default":null},"callstack":{"if":{"is_string":"biota.core@0.0.1+KeysInsertMany"},"then":{"prepend":{"select":"callstack","from":{"var":"ctx"},"default":[]},"collection":["biota.core@0.0.1+KeysInsertMany"]},"else":{"select":"callstack","from":{"var":"ctx"},"default":[]}},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"success":{"select":"success","from":{"var":"ctx"},"default":true}}}}],"in":{"let":[{"response":{"map":{"lambda":["definition"],"expr":{"select":"response","from":{"call":"biota.core@0.0.1+KeyInsert","arguments":[{"var":"ctx"},{"object":{"options":null}}]},"default":{"object":{}}}},"collection":{"var":"optionsList"}}}],"in":{"object":{"response":{"var":"response"},"success":{"select":"success","from":{"var":"ctx"},"default":true},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"ts":{"now":null}}}}}}}],"in":{"var":"biota.core@0.0.1+KeysInsertMany"}}}}}}},"else":{"create_function":{"object":{"name":"biota.core@0.0.1+KeysInsertMany","body":{"query":{"lambda":["ctx","params"],"expr":{"let":[{"biota.core@0.0.1+KeysInsertMany":{"let":[{"data":{"object":{}}},{"ref":{"object":{}}},{"optionsList":{"select":"optionsList","from":{"var":"params"},"default":[]}},{"_inputs":{"object":{"optionsList":{"select":"optionsList","from":{"var":"params"},"default":[]}}}},{"annotate":{"object":{}}}],"in":{"let":[{"ctx":{"object":{}}},{"ctx":{"object":{"identity":{"select":"identity","from":{"var":"ctx"},"default":null},"session":{"select":"session","from":{"var":"ctx"},"default":null},"callstack":{"if":{"is_string":"biota.core@0.0.1+KeysInsertMany"},"then":{"prepend":{"select":"callstack","from":{"var":"ctx"},"default":[]},"collection":["biota.core@0.0.1+KeysInsertMany"]},"else":{"select":"callstack","from":{"var":"ctx"},"default":[]}},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"success":{"select":"success","from":{"var":"ctx"},"default":true}}}}],"in":{"let":[{"response":{"map":{"lambda":["definition"],"expr":{"select":"response","from":{"call":"biota.core@0.0.1+KeyInsert","arguments":[{"var":"ctx"},{"object":{"options":null}}]},"default":{"object":{}}}},"collection":{"var":"optionsList"}}}],"in":{"object":{"response":{"var":"response"},"success":{"select":"success","from":{"var":"ctx"},"default":true},"actions":{"select":"actions","from":{"var":"ctx"},"default":[]},"errors":{"select":"errors","from":{"var":"ctx"},"default":[]},"ts":{"now":null}}}}}}}],"in":{"var":"biota.core@0.0.1+KeysInsertMany"}}}}}}}}}}]}'
